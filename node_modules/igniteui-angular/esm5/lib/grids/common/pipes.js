import { __decorate, __extends, __param, __read, __spread, __values } from "tslib";
import { Pipe, Inject, LOCALE_ID } from '@angular/core';
import { GridBaseAPIService } from '../api.service';
import { DataUtil } from '../../data-operations/data-util';
import { cloneArray } from '../../core/utils';
import { DatePipe, DecimalPipe } from '@angular/common';
/**
 * @hidden
 * @internal
 */
var IgxGridCellStyleClassesPipe = /** @class */ (function () {
    function IgxGridCellStyleClassesPipe() {
    }
    IgxGridCellStyleClassesPipe.prototype.transform = function (cssClasses, value, data, field, index) {
        var e_1, _a;
        if (!cssClasses) {
            return '';
        }
        var result = [];
        try {
            for (var _b = __values(Object.keys(cssClasses)), _c = _b.next(); !_c.done; _c = _b.next()) {
                var cssClass = _c.value;
                var callbackOrValue = cssClasses[cssClass];
                var apply = typeof callbackOrValue === 'function' ? callbackOrValue(data, field, value, index) : callbackOrValue;
                if (apply) {
                    result.push(cssClass);
                }
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_1) throw e_1.error; }
        }
        return result.join(' ');
    };
    IgxGridCellStyleClassesPipe = __decorate([
        Pipe({
            name: 'igxCellStyleClasses'
        })
    ], IgxGridCellStyleClassesPipe);
    return IgxGridCellStyleClassesPipe;
}());
export { IgxGridCellStyleClassesPipe };
/**
 * @hidden
 * @internal
 */
var IgxGridCellStylesPipe = /** @class */ (function () {
    function IgxGridCellStylesPipe() {
    }
    IgxGridCellStylesPipe.prototype.transform = function (styles, value, data, field, index) {
        var e_2, _a;
        var css = {};
        if (!styles) {
            return css;
        }
        try {
            for (var _b = __values(Object.keys(styles)), _c = _b.next(); !_c.done; _c = _b.next()) {
                var prop = _c.value;
                var res = styles[prop];
                css[prop] = typeof res === 'function' ? res(data, field, value, index) : res;
            }
        }
        catch (e_2_1) { e_2 = { error: e_2_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_2) throw e_2.error; }
        }
        return css;
    };
    IgxGridCellStylesPipe = __decorate([
        Pipe({
            name: 'igxCellStyles'
        })
    ], IgxGridCellStylesPipe);
    return IgxGridCellStylesPipe;
}());
export { IgxGridCellStylesPipe };
/**
 * @hidden
 * @internal
 */
var IgxGridNotGroupedPipe = /** @class */ (function () {
    function IgxGridNotGroupedPipe() {
    }
    IgxGridNotGroupedPipe.prototype.transform = function (value) {
        return value.filter(function (item) { return !item.columnGroup; });
    };
    IgxGridNotGroupedPipe = __decorate([
        Pipe({
            name: 'igxNotGrouped'
        })
    ], IgxGridNotGroupedPipe);
    return IgxGridNotGroupedPipe;
}());
export { IgxGridNotGroupedPipe };
/**
 * @hidden
 * @internal
 */
var IgxGridTopLevelColumns = /** @class */ (function () {
    function IgxGridTopLevelColumns() {
    }
    IgxGridTopLevelColumns.prototype.transform = function (value) {
        return value.filter(function (item) { return item.level === 0; });
    };
    IgxGridTopLevelColumns = __decorate([
        Pipe({
            name: 'igxTopLevel'
        })
    ], IgxGridTopLevelColumns);
    return IgxGridTopLevelColumns;
}());
export { IgxGridTopLevelColumns };
/**
 * @hidden
 * @internal
 */
var IgxGridFilterConditionPipe = /** @class */ (function () {
    function IgxGridFilterConditionPipe() {
    }
    IgxGridFilterConditionPipe.prototype.transform = function (value) {
        return value.split(/(?=[A-Z])/).join(' ');
    };
    IgxGridFilterConditionPipe = __decorate([
        Pipe({
            name: 'filterCondition',
            pure: true
        })
    ], IgxGridFilterConditionPipe);
    return IgxGridFilterConditionPipe;
}());
export { IgxGridFilterConditionPipe };
/**
 * @hidden
 * @internal
 */
var IgxGridTransactionPipe = /** @class */ (function () {
    function IgxGridTransactionPipe(gridAPI) {
        this.gridAPI = gridAPI;
    }
    IgxGridTransactionPipe.prototype.transform = function (collection, id, pipeTrigger) {
        var grid = this.gridAPI.grid;
        if (grid.transactions.enabled) {
            var result = DataUtil.mergeTransactions(cloneArray(collection), grid.transactions.getAggregatedChanges(true), grid.primaryKey);
            return result;
        }
        return collection;
    };
    IgxGridTransactionPipe.ctorParameters = function () { return [
        { type: GridBaseAPIService }
    ]; };
    IgxGridTransactionPipe = __decorate([
        Pipe({
            name: 'gridTransaction',
            pure: true
        })
    ], IgxGridTransactionPipe);
    return IgxGridTransactionPipe;
}());
export { IgxGridTransactionPipe };
/**
 * @hidden
 * @internal
 */
var IgxGridPaginatorOptionsPipe = /** @class */ (function () {
    function IgxGridPaginatorOptionsPipe() {
    }
    IgxGridPaginatorOptionsPipe.prototype.transform = function (values) {
        return Array.from(new Set(__spread(values))).sort(function (a, b) { return a - b; });
    };
    IgxGridPaginatorOptionsPipe = __decorate([
        Pipe({
            name: 'paginatorOptions',
            pure: true,
        })
    ], IgxGridPaginatorOptionsPipe);
    return IgxGridPaginatorOptionsPipe;
}());
export { IgxGridPaginatorOptionsPipe };
/**
 * @hidden
 * @internal
 */
var IgxHasVisibleColumnsPipe = /** @class */ (function () {
    function IgxHasVisibleColumnsPipe() {
    }
    IgxHasVisibleColumnsPipe.prototype.transform = function (values, hasVisibleColumns) {
        if (!(values && values.length)) {
            return values;
        }
        return hasVisibleColumns ? values : [];
    };
    IgxHasVisibleColumnsPipe = __decorate([
        Pipe({
            name: 'visibleColumns',
            pure: true
        })
    ], IgxHasVisibleColumnsPipe);
    return IgxHasVisibleColumnsPipe;
}());
export { IgxHasVisibleColumnsPipe };
/**
 * @hidden
 * @internal
 */
var IgxDatePipeComponent = /** @class */ (function (_super) {
    __extends(IgxDatePipeComponent, _super);
    function IgxDatePipeComponent(locale) {
        var _this = 
        // D.P. constructor duplication due to es6 compilation, might be obsolete in the future
        _super.call(this, locale) || this;
        _this.DEFAULT_DATE_FORMAT = 'mediumDate';
        return _this;
    }
    IgxDatePipeComponent.prototype.transform = function (value, locale) {
        if (value && value instanceof Date) {
            if (locale) {
                return _super.prototype.transform.call(this, value, this.DEFAULT_DATE_FORMAT, undefined, locale);
            }
            else {
                return _super.prototype.transform.call(this, value);
            }
        }
        else {
            return value;
        }
    };
    IgxDatePipeComponent.ctorParameters = function () { return [
        { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] }
    ]; };
    IgxDatePipeComponent = __decorate([
        Pipe({
            name: 'igxdate'
        }),
        __param(0, Inject(LOCALE_ID))
    ], IgxDatePipeComponent);
    return IgxDatePipeComponent;
}(DatePipe));
export { IgxDatePipeComponent };
/**
 * @hidden
 * @internal
 */
var IgxDecimalPipeComponent = /** @class */ (function (_super) {
    __extends(IgxDecimalPipeComponent, _super);
    function IgxDecimalPipeComponent(locale) {
        // D.P. constructor duplication due to es6 compilation, might be obsolete in the future
        return _super.call(this, locale) || this;
    }
    IgxDecimalPipeComponent.prototype.transform = function (value, locale) {
        if (value && typeof value === 'number') {
            if (locale) {
                return _super.prototype.transform.call(this, value, undefined, locale);
            }
            else {
                return _super.prototype.transform.call(this, value);
            }
        }
        else {
            return value;
        }
    };
    IgxDecimalPipeComponent.ctorParameters = function () { return [
        { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] }
    ]; };
    IgxDecimalPipeComponent = __decorate([
        Pipe({
            name: 'igxdecimal'
        }),
        __param(0, Inject(LOCALE_ID))
    ], IgxDecimalPipeComponent);
    return IgxDecimalPipeComponent;
}(DecimalPipe));
export { IgxDecimalPipeComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGlwZXMuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9pZ25pdGV1aS1hbmd1bGFyLyIsInNvdXJjZXMiOlsibGliL2dyaWRzL2NvbW1vbi9waXBlcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLElBQUksRUFBaUIsTUFBTSxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN2RSxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUVwRCxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0saUNBQWlDLENBQUM7QUFDM0QsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBRTlDLE9BQU8sRUFBRSxRQUFRLEVBQUUsV0FBVyxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFFeEQ7OztHQUdHO0FBSUg7SUFBQTtJQW1CQSxDQUFDO0lBakJHLCtDQUFTLEdBQVQsVUFBVSxVQUFtQyxFQUFFLEtBQVUsRUFBRSxJQUFTLEVBQUUsS0FBYSxFQUFFLEtBQWE7O1FBQzlGLElBQUksQ0FBQyxVQUFVLEVBQUU7WUFDYixPQUFPLEVBQUUsQ0FBQztTQUNiO1FBRUQsSUFBTSxNQUFNLEdBQUcsRUFBRSxDQUFDOztZQUVsQixLQUF1QixJQUFBLEtBQUEsU0FBQSxNQUFNLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFBLGdCQUFBLDRCQUFFO2dCQUEzQyxJQUFNLFFBQVEsV0FBQTtnQkFDZixJQUFNLGVBQWUsR0FBRyxVQUFVLENBQUMsUUFBUSxDQUFDLENBQUM7Z0JBQzdDLElBQU0sS0FBSyxHQUFHLE9BQU8sZUFBZSxLQUFLLFVBQVUsQ0FBQyxDQUFDLENBQUMsZUFBZSxDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxlQUFlLENBQUM7Z0JBQ25ILElBQUksS0FBSyxFQUFFO29CQUNQLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7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SUFDcEQsaUNBQStCLE1BQWM7UUFDekMsdUZBQXVGO2VBQ3ZGLGtCQUFNLE1BQU0sQ0FBQztJQUNqQixDQUFDO0lBQ0QsMkNBQVMsR0FBVCxVQUFVLEtBQVUsRUFBRSxNQUFjO1FBQ2hDLElBQUksS0FBSyxJQUFJLE9BQU8sS0FBSyxLQUFLLFFBQVEsRUFBRTtZQUNwQyxJQUFJLE1BQU0sRUFBRTtnQkFDUixPQUFPLGlCQUFNLFNBQVMsWUFBQyxLQUFLLEVBQUUsU0FBUyxFQUFFLE1BQU0sQ0FBQyxDQUFDO2FBQ3BEO2lCQUFNO2dCQUNILE9BQU8saUJBQU0sU0FBUyxZQUFDLEtBQUssQ0FBQyxDQUFDO2FBQ2pDO1NBQ0o7YUFBTTtZQUNILE9BQU8sS0FBSyxDQUFDO1NBQ2hCO0lBQ0wsQ0FBQzs7NkNBZFksTUFBTSxTQUFDLFNBQVM7O0lBRHBCLHVCQUF1QjtRQUhuQyxJQUFJLENBQUM7WUFDRixJQUFJLEVBQUUsWUFBWTtTQUNyQixDQUFDO1FBRWUsV0FBQSxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUE7T0FEckIsdUJBQXVCLENBZ0JuQztJQUFELDhCQUFDO0NBQUEsQUFoQkQsQ0FBNkMsV0FBVyxHQWdCdkQ7U0FoQlksdUJBQXVCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUGlwZSwgUGlwZVRyYW5zZm9ybSwgSW5qZWN0LCBMT0NBTEVfSUQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEdyaWRCYXNlQVBJU2VydmljZSB9IGZyb20gJy4uL2FwaS5zZXJ2aWNlJztcbmltcG9ydCB7IElneEdyaWRCYXNlRGlyZWN0aXZlIH0gZnJvbSAnLi4vZ3JpZC1iYXNlLmRpcmVjdGl2ZSc7XG5pbXBvcnQgeyBEYXRhVXRpbCB9IGZyb20gJy4uLy4uL2RhdGEtb3BlcmF0aW9ucy9kYXRhLXV0aWwnO1xuaW1wb3J0IHsgY2xvbmVBcnJheSB9IGZyb20gJy4uLy4uL2NvcmUvdXRpbHMnO1xuaW1wb3J0IHsgR3JpZFR5cGUgfSBmcm9tICcuL2dyaWQuaW50ZXJmYWNlJztcbmltcG9ydCB7IERhdGVQaXBlLCBEZWNpbWFsUGlwZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5cbi8qKlxuICogQGhpZGRlblxuICogQGludGVybmFsXG4gKi9cbkBQaXBlKHtcbiAgICBuYW1lOiAnaWd4Q2VsbFN0eWxlQ2xhc3Nlcydcbn0pXG5leHBvcnQgY2xhc3MgSWd4R3JpZENlbGxTdHlsZUNsYXNzZXNQaXBlIGltcGxlbWVudHMgUGlwZVRyYW5zZm9ybSB7XG5cbiAgICB0cmFuc2Zvcm0oY3NzQ2xhc3NlczogeyBbcHJvcDogc3RyaW5nXTogYW55IH0sIHZhbHVlOiBhbnksIGRhdGE6IGFueSwgZmllbGQ6IHN0cmluZywgaW5kZXg6IG51bWJlcik6IHN0cmluZyB7XG4gICAgICAgIGlmICghY3NzQ2xhc3Nlcykge1xuICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gW107XG5cbiAgICAgICAgZm9yIChjb25zdCBjc3NDbGFzcyBvZiBPYmplY3Qua2V5cyhjc3NDbGFzc2VzKSkge1xuICAgICAgICAgICAgY29uc3QgY2FsbGJhY2tPclZhbHVlID0gY3NzQ2xhc3Nlc1tjc3NDbGFzc107XG4gICAgICAgICAgICBjb25zdCBhcHBseSA9IHR5cGVvZiBjYWxsYmFja09yVmFsdWUgPT09ICdmdW5jdGlvbicgPyBjYWxsYmFja09yVmFsdWUoZGF0YSwgZmllbGQsIHZhbHVlLCBpbmRleCkgOiBjYWxsYmFja09yVmFsdWU7XG4gICAgICAgICAgICBpZiAoYXBwbHkpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaChjc3NDbGFzcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcmVzdWx0LmpvaW4oJyAnKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGhpZGRlblxuICogQGludGVybmFsXG4gKi9cbkBQaXBlKHtcbiAgICBuYW1lOiAnaWd4Q2VsbFN0eWxlcydcbn0pXG5leHBvcnQgY2xhc3MgSWd4R3JpZENlbGxTdHlsZXNQaXBlIGltcGxlbWVudHMgUGlwZVRyYW5zZm9ybSB7XG5cbiAgICB0cmFuc2Zvcm0oc3R5bGVzOiB7IFtwcm9wOiBzdHJpbmddOiBhbnkgfSwgdmFsdWU6IGFueSwgZGF0YTogYW55LCBmaWVsZDogc3RyaW5nLCBpbmRleDogbnVtYmVyKTogeyBbcHJvcDogc3RyaW5nXTogYW55IH0ge1xuICAgICAgICBjb25zdCBjc3MgPSB7fTtcbiAgICAgICAgaWYgKCFzdHlsZXMpIHtcbiAgICAgICAgICAgIHJldHVybiBjc3M7XG4gICAgICAgIH1cblxuICAgICAgICBmb3IgKGNvbnN0IHByb3Agb2YgT2JqZWN0LmtleXMoc3R5bGVzKSkge1xuICAgICAgICAgICAgY29uc3QgcmVzID0gc3R5bGVzW3Byb3BdO1xuICAgICAgICAgICAgY3NzW3Byb3BdID0gdHlwZW9mIHJlcyA9PT0gJ2Z1bmN0aW9uJyA/IHJlcyhkYXRhLCBmaWVsZCwgdmFsdWUsIGluZGV4KSA6IHJlcztcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBjc3M7XG4gICAgfVxufVxuXG4vKipcbiAqIEBoaWRkZW5cbiAqIEBpbnRlcm5hbFxuICovXG5AUGlwZSh7XG4gICAgbmFtZTogJ2lneE5vdEdyb3VwZWQnXG59KVxuZXhwb3J0IGNsYXNzIElneEdyaWROb3RHcm91cGVkUGlwZSBpbXBsZW1lbnRzIFBpcGVUcmFuc2Zvcm0ge1xuXG4gICAgdHJhbnNmb3JtKHZhbHVlOiBhbnlbXSk6IGFueVtdIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlLmZpbHRlcihpdGVtID0+ICFpdGVtLmNvbHVtbkdyb3VwKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGhpZGRlblxuICogQGludGVybmFsXG4gKi9cbkBQaXBlKHtcbiAgICBuYW1lOiAnaWd4VG9wTGV2ZWwnXG59KVxuZXhwb3J0IGNsYXNzIElneEdyaWRUb3BMZXZlbENvbHVtbnMgaW1wbGVtZW50cyBQaXBlVHJhbnNmb3JtIHtcblxuICAgIHRyYW5zZm9ybSh2YWx1ZTogYW55W10pOiBhbnlbXSB7XG4gICAgICAgIHJldHVybiB2YWx1ZS5maWx0ZXIoaXRlbSA9PiBpdGVtLmxldmVsID09PSAwKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGhpZGRlblxuICogQGludGVybmFsXG4gKi9cbkBQaXBlKHtcbiAgICBuYW1lOiAnZmlsdGVyQ29uZGl0aW9uJyxcbiAgICBwdXJlOiB0cnVlXG59KVxuZXhwb3J0IGNsYXNzIElneEdyaWRGaWx0ZXJDb25kaXRpb25QaXBlIGltcGxlbWVudHMgUGlwZVRyYW5zZm9ybSB7XG5cbiAgICBwdWJsaWMgdHJhbnNmb3JtKHZhbHVlOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdmFsdWUuc3BsaXQoLyg/PVtBLVpdKS8pLmpvaW4oJyAnKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGhpZGRlblxuICogQGludGVybmFsXG4gKi9cbkBQaXBlKHtcbiAgICBuYW1lOiAnZ3JpZFRyYW5zYWN0aW9uJyxcbiAgICBwdXJlOiB0cnVlXG59KVxuZXhwb3J0IGNsYXNzIElneEdyaWRUcmFuc2FjdGlvblBpcGUgaW1wbGVtZW50cyBQaXBlVHJhbnNmb3JtIHtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgZ3JpZEFQSTogR3JpZEJhc2VBUElTZXJ2aWNlPElneEdyaWRCYXNlRGlyZWN0aXZlICYgR3JpZFR5cGU+KSB7IH1cblxuICAgIHRyYW5zZm9ybShjb2xsZWN0aW9uOiBhbnlbXSwgaWQ6IHN0cmluZywgcGlwZVRyaWdnZXI6IG51bWJlcikge1xuICAgICAgICBjb25zdCBncmlkOiBJZ3hHcmlkQmFzZURpcmVjdGl2ZSA9IHRoaXMuZ3JpZEFQSS5ncmlkO1xuXG4gICAgICAgIGlmICggZ3JpZC50cmFuc2FjdGlvbnMuZW5hYmxlZCkge1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gRGF0YVV0aWwubWVyZ2VUcmFuc2FjdGlvbnMoXG4gICAgICAgICAgICAgICAgY2xvbmVBcnJheShjb2xsZWN0aW9uKSxcbiAgICAgICAgICAgICAgICBncmlkLnRyYW5zYWN0aW9ucy5nZXRBZ2dyZWdhdGVkQ2hhbmdlcyh0cnVlKSxcbiAgICAgICAgICAgICAgICBncmlkLnByaW1hcnlLZXkpO1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY29sbGVjdGlvbjtcbiAgICB9XG59XG5cbi8qKlxuICogQGhpZGRlblxuICogQGludGVybmFsXG4gKi9cbkBQaXBlKHtcbiAgICBuYW1lOiAncGFnaW5hdG9yT3B0aW9ucycsXG4gICAgcHVyZTogdHJ1ZSxcbn0pXG5leHBvcnQgY2xhc3MgSWd4R3JpZFBhZ2luYXRvck9wdGlvbnNQaXBlIGltcGxlbWVudHMgUGlwZVRyYW5zZm9ybSB7XG4gICAgcHVibGljIHRyYW5zZm9ybSh2YWx1ZXM6IEFycmF5PG51bWJlcj4pIHtcbiAgICAgICAgcmV0dXJuIEFycmF5LmZyb20obmV3IFNldChbLi4udmFsdWVzXSkpLnNvcnQoKGEsIGIpID0+IGEgLSBiKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGhpZGRlblxuICogQGludGVybmFsXG4gKi9cbkBQaXBlKHtcbiAgICBuYW1lOiAndmlzaWJsZUNvbHVtbnMnLFxuICAgIHB1cmU6IHRydWVcbn0pXG5leHBvcnQgY2xhc3MgSWd4SGFzVmlzaWJsZUNvbHVtbnNQaXBlIGltcGxlbWVudHMgUGlwZVRyYW5zZm9ybSB7XG4gICAgdHJhbnNmb3JtKHZhbHVlczogYW55W10sIGhhc1Zpc2libGVDb2x1bW5zKSB7XG4gICAgICAgIGlmICghKHZhbHVlcyAmJiB2YWx1ZXMubGVuZ3RoKSkge1xuICAgICAgICAgICAgcmV0dXJuIHZhbHVlcztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaGFzVmlzaWJsZUNvbHVtbnMgPyB2YWx1ZXMgOiBbXTtcbiAgICB9XG5cbn1cblxuXG4vKipcbiAqIEBoaWRkZW5cbiAqIEBpbnRlcm5hbFxuICovXG5AUGlwZSh7XG4gICAgbmFtZTogJ2lneGRhdGUnXG59KVxuZXhwb3J0IGNsYXNzIElneERhdGVQaXBlQ29tcG9uZW50IGV4dGVuZHMgRGF0ZVBpcGUgaW1wbGVtZW50cyBQaXBlVHJhbnNmb3JtIHtcblxuICAgIHByaXZhdGUgcmVhZG9ubHkgREVGQVVMVF9EQVRFX0ZPUk1BVCA9ICdtZWRpdW1EYXRlJztcblxuICAgIGNvbnN0cnVjdG9yKEBJbmplY3QoTE9DQUxFX0lEKSBsb2NhbGU6IHN0cmluZykge1xuICAgICAgICAvLyBELlAuIGNvbnN0cnVjdG9yIGR1cGxpY2F0aW9uIGR1ZSB0byBlczYgY29tcGlsYXRpb24sIG1pZ2h0IGJlIG9ic29sZXRlIGluIHRoZSBmdXR1cmVcbiAgICAgICAgc3VwZXIobG9jYWxlKTtcbiAgICB9XG4gICAgdHJhbnNmb3JtKHZhbHVlOiBhbnksIGxvY2FsZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgaWYgKHZhbHVlICYmIHZhbHVlIGluc3RhbmNlb2YgRGF0ZSkge1xuICAgICAgICAgICAgaWYgKGxvY2FsZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBzdXBlci50cmFuc2Zvcm0odmFsdWUsIHRoaXMuREVGQVVMVF9EQVRFX0ZPUk1BVCwgdW5kZWZpbmVkLCBsb2NhbGUpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIudHJhbnNmb3JtKHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuLyoqXG4gKiBAaGlkZGVuXG4gKiBAaW50ZXJuYWxcbiAqL1xuQFBpcGUoe1xuICAgIG5hbWU6ICdpZ3hkZWNpbWFsJ1xufSlcbmV4cG9ydCBjbGFzcyBJZ3hEZWNpbWFsUGlwZUNvbXBvbmVudCBleHRlbmRzIERlY2ltYWxQaXBlIGltcGxlbWVudHMgUGlwZVRyYW5zZm9ybSB7XG4gICAgY29uc3RydWN0b3IoQEluamVjdChMT0NBTEVfSUQpIGxvY2FsZTogc3RyaW5nKSB7XG4gICAgICAgIC8vIEQuUC4gY29uc3RydWN0b3IgZHVwbGljYXRpb24gZHVlIHRvIGVzNiBjb21waWxhdGlvbiwgbWlnaHQgYmUgb2Jzb2xldGUgaW4gdGhlIGZ1dHVyZVxuICAgICAgICBzdXBlcihsb2NhbGUpO1xuICAgIH1cbiAgICB0cmFuc2Zvcm0odmFsdWU6IGFueSwgbG9jYWxlOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgICAgICBpZiAodmFsdWUgJiYgdHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgaWYgKGxvY2FsZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBzdXBlci50cmFuc2Zvcm0odmFsdWUsIHVuZGVmaW5lZCwgbG9jYWxlKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLnRyYW5zZm9ybSh2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgIH1cbiAgICB9XG59XG4iXX0=