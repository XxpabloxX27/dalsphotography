import { __decorate } from "tslib";
import { Injectable } from '@angular/core';
import { first } from 'rxjs/operators';
import { IgxGridNavigationService } from './grid-navigation.service';
export var NavigationDirection;
(function (NavigationDirection) {
    NavigationDirection["horizontal"] = "horizontal";
    NavigationDirection["vertical"] = "vertical";
})(NavigationDirection || (NavigationDirection = {}));
/** @hidden */
let IgxGridMRLNavigationService = class IgxGridMRLNavigationService extends IgxGridNavigationService {
    /**
     * @hidden
     * @internal
     */
    setStartNavigationCell(colStart, rowStart, dir) {
        this.startNavigationCell = {
            colStart: colStart,
            rowStart: rowStart,
            direction: dir
        };
    }
    applyNavigationCell(colStart, rowStart, navDirection) {
        const oppositeDir = navDirection === NavigationDirection.vertical ?
            NavigationDirection.horizontal : NavigationDirection.vertical;
        if (this.startNavigationCell && this.startNavigationCell.direction !== navDirection) {
            this.startNavigationCell.direction = oppositeDir;
        }
        else {
            this.setStartNavigationCell(colStart, rowStart, oppositeDir);
        }
        return navDirection === NavigationDirection.vertical ?
            this.startNavigationCell.colStart : this.startNavigationCell.rowStart;
    }
    navigateUp(rowElement, selectedNode) {
        this.focusCellUpFromLayout(rowElement, selectedNode);
    }
    navigateDown(rowElement, selectedNode) {
        this.focusCellDownFromLayout(rowElement, selectedNode);
    }
    isColumnRightEdgeVisible(visibleColumnIndex) {
        const column = this.grid.columnList.filter(c => !c.columnGroup).find((col) => col.visibleIndex === visibleColumnIndex);
        const forOfDir = this.grid.headerContainer;
        const horizontalScroll = forOfDir.getScroll();
        if (!horizontalScroll.clientWidth || (column && column.pinned)) {
            return true;
        }
        else if (column) {
            if (this.isParentColumnFullyVisible(column)) {
                return true;
            }
            const scrollPos = this.getChildColumnScrollPositions(visibleColumnIndex);
            return this.displayContainerWidth >= scrollPos.rightScroll - this.displayContainerScrollLeft &&
                this.displayContainerScrollLeft <= scrollPos.leftScroll;
        }
        return false;
    }
    isParentColumnFullyVisible(parent) {
        const forOfDir = this.grid.dataRowList.length > 0 ? this.grid.dataRowList.first.virtDirRow : this.grid.headerContainer;
        const horizontalScroll = forOfDir.getScroll();
        if (!horizontalScroll.clientWidth || parent.pinned) {
            return true;
        }
        const index = forOfDir.igxForOf.indexOf(parent);
        return this.displayContainerWidth >= forOfDir.getColumnScrollLeft(index + 1) - this.displayContainerScrollLeft &&
            this.displayContainerScrollLeft <= forOfDir.getColumnScrollLeft(index);
    }
    isColumnLeftEdgeVisible(visibleColumnIndex) {
        const forOfDir = this.grid.headerContainer;
        const horizontalScroll = forOfDir.getScroll();
        const column = this.grid.columnList.filter(c => !c.columnGroup).find((col) => col.visibleIndex === visibleColumnIndex);
        if (!horizontalScroll.clientWidth || column.pinned) {
            return true;
        }
        if (this.isParentColumnFullyVisible(column)) {
            return true;
        }
        const scrollPos = this.getChildColumnScrollPositions(visibleColumnIndex);
        return this.displayContainerScrollLeft <= scrollPos.leftScroll;
    }
    onKeydownArrowRight(element, selectedNode) {
        this.focusNextCellFromLayout(element, selectedNode);
    }
    onKeydownArrowLeft(element, selectedNode) {
        this.focusPrevCellFromLayout(element, selectedNode);
    }
    get gridOrderedColumns() {
        return [...this.grid.pinnedColumns, ...this.grid.unpinnedColumns].filter(c => !c.columnGroup)
            .sort((a, b) => a.visibleIndex - b.visibleIndex);
    }
    performTab(currentRowEl, selectedNode) {
        const visibleColumnIndex = selectedNode.layout ? selectedNode.layout.columnVisibleIndex : 0;
        const nextElementColumn = this.grid.columns.find(x => !x.columnGroup && x.visibleIndex === visibleColumnIndex + 1);
        const rowIndex = selectedNode.row;
        const row = this.grid.getRowByIndex(rowIndex);
        this._moveFocusToCell(currentRowEl, nextElementColumn, row, selectedNode, 'next');
        if (nextElementColumn) {
            this.setStartNavigationCell(nextElementColumn.colStart, nextElementColumn.rowStart, null);
        }
    }
    _moveFocusToCell(currentRowEl, nextElementColumn, row, selectedNode, dir) {
        if (nextElementColumn && row.cells) {
            let nextCell = row.cells.find(currCell => currCell.column === nextElementColumn);
            const isVisible = this.isColumnRightEdgeVisible(nextElementColumn.visibleIndex);
            if (!nextCell || !isVisible) {
                this.grid.nativeElement.focus({ preventScroll: true });
                const cb = () => {
                    nextCell = row.cells.find(currCell => currCell.column === nextElementColumn);
                    if (this.grid.rowEditable && this.isRowInEditMode(row.index)) {
                        if (dir === 'next') {
                            this.moveNextEditable(row.index, selectedNode.layout.columnVisibleIndex);
                        }
                        else {
                            this.movePreviousEditable(row.index, selectedNode.layout.columnVisibleIndex);
                        }
                        return;
                    }
                    this._focusCell(nextCell.nativeElement);
                };
                this.performHorizontalScrollToCell(row.index, nextElementColumn.visibleIndex, false, cb);
            }
            else {
                if (this.grid.rowEditable && this.isRowInEditMode(row.index)) {
                    if (dir === 'next') {
                        this.moveNextEditable(row.index, selectedNode.layout.columnVisibleIndex);
                    }
                    else {
                        this.movePreviousEditable(row.index, selectedNode.layout.columnVisibleIndex);
                    }
                    return;
                }
                this._focusCell(nextCell.nativeElement);
            }
        }
        else {
            // end of layout reached
            if (this.isRowInEditMode(row.index)) {
                //  TODO: make gridAPI visible for internal use and remove cast to any
                this.grid.gridAPI.submit_value();
                if (dir === 'next') {
                    this.grid.rowEditTabs.first.element.nativeElement.focus();
                }
                else {
                    this.grid.rowEditTabs.last.element.nativeElement.focus();
                }
                return;
            }
            if (dir === 'next') {
                super.navigateDown(currentRowEl, { row: row.index, column: 0 });
            }
            else {
                let lastVisibleIndex = 0;
                this.grid.unpinnedColumns.forEach((col) => {
                    lastVisibleIndex = Math.max(lastVisibleIndex, col.visibleIndex);
                });
                super.navigateUp(currentRowEl, { row: row.index, column: lastVisibleIndex });
            }
        }
    }
    performShiftTabKey(currentRowEl, selectedNode) {
        const visibleColumnIndex = selectedNode.layout ? selectedNode.layout.columnVisibleIndex : 0;
        const rowIndex = selectedNode.row;
        const row = this.grid.getRowByIndex(rowIndex);
        const prevElementColumn = this.grid.columns.find(x => !x.columnGroup && x.visibleIndex === visibleColumnIndex - 1 && !x.hidden);
        this._moveFocusToCell(currentRowEl, prevElementColumn, row, selectedNode, 'prev');
        if (prevElementColumn) {
            this.setStartNavigationCell(prevElementColumn.colStart, prevElementColumn.rowStart, null);
        }
    }
    focusCellUpFromLayout(rowElement, selectedNode) {
        const isNonDataRow = rowElement.tagName.toLowerCase() === 'igx-grid-groupby-row' || this._isDetailRecordAt(selectedNode.row);
        const currentRowStart = selectedNode.layout ? selectedNode.layout.rowStart : 1;
        const currentColStart = this.applyNavigationCell(selectedNode.layout ? selectedNode.layout.colStart : 1, currentRowStart, NavigationDirection.vertical);
        const parentIndex = selectedNode.column;
        const columnLayout = this.grid.columns.find(x => x.columnLayout && x.visibleIndex === parentIndex);
        let movePrev;
        // check if element up is from the same layout
        let upperElementColumn = columnLayout.children.find(c => (c.rowEnd === currentRowStart || c.rowStart + c.gridRowSpan === currentRowStart) &&
            c.colStart <= currentColStart &&
            (currentColStart < c.colEnd || currentColStart < c.colStart + c.gridColumnSpan));
        if (isNonDataRow || !upperElementColumn) {
            // no prev row in current row layout, go to next row last rowstart
            const layoutRowEnd = this.grid.multiRowLayoutRowSize + 1;
            upperElementColumn = columnLayout.children.find(c => (c.rowEnd === layoutRowEnd || c.rowStart + c.gridRowSpan === layoutRowEnd) &&
                c.colStart <= currentColStart &&
                (currentColStart < c.colEnd || currentColStart < c.colStart + c.gridColumnSpan));
            movePrev = true;
        }
        const rowIndex = movePrev ? selectedNode.row - 1 : selectedNode.row;
        if (rowIndex < 0) {
            // end of rows reached.
            return;
        }
        let prevRow;
        const cb = () => {
            prevRow = this.grid.getRowByIndex(rowIndex);
            if (prevRow && prevRow.cells) {
                this._focusCell(upperElementColumn.cells.find((c) => c.rowIndex === prevRow.index).nativeElement);
            }
            else if (prevRow) {
                prevRow.nativeElement.focus({ preventScroll: true });
            }
            else {
                const prevElem = this.getRowByIndex(rowIndex, '');
                prevElem.focus({ preventScroll: true });
            }
        };
        if (this.shouldPerformVerticalScroll(rowIndex, upperElementColumn.visibleIndex)) {
            this.grid.nativeElement.focus({ preventScroll: true });
            this.performVerticalScrollToCell(rowIndex, upperElementColumn.visibleIndex, cb);
        }
        else {
            cb();
        }
    }
    focusCellDownFromLayout(rowElement, selectedNode) {
        const isNonDataRow = rowElement.tagName.toLowerCase() === 'igx-grid-groupby-row' || this._isDetailRecordAt(selectedNode.row);
        const parentIndex = selectedNode.column;
        const columnLayout = this.grid.columns.find(x => x.columnLayout && x.visibleIndex === parentIndex);
        const currentRowEnd = selectedNode.layout ? selectedNode.layout.rowEnd || selectedNode.layout.rowStart + 1 : 2;
        const currentColStart = this.applyNavigationCell(selectedNode.layout ? selectedNode.layout.colStart : 1, selectedNode.layout ? selectedNode.layout.rowStart : 1, NavigationDirection.vertical);
        let moveNext;
        // check if element down is from the same layout
        let nextElementColumn = columnLayout.children.find(c => c.rowStart === currentRowEnd &&
            c.colStart <= currentColStart &&
            (currentColStart < c.colEnd || currentColStart < c.colStart + c.gridColumnSpan));
        if (isNonDataRow || !nextElementColumn) {
            // no next row in current row layout, go to next row first rowstart
            nextElementColumn = columnLayout.children.find(c => c.rowStart === 1 &&
                c.colStart <= currentColStart &&
                (currentColStart < c.colEnd || currentColStart < c.colStart + c.gridColumnSpan));
            moveNext = true;
        }
        const rowIndex = moveNext ? selectedNode.row + 1 : selectedNode.row;
        if (rowIndex > this.grid.dataView.length - 1) {
            // end of rows reached.
            return;
        }
        let nextRow;
        const cb = () => {
            nextRow = this.grid.getRowByIndex(rowIndex);
            if (nextRow && nextRow.cells) {
                this._focusCell(nextElementColumn.cells.find((c) => c.rowIndex === nextRow.index).nativeElement);
            }
            else if (nextRow) {
                nextRow.nativeElement.focus({ preventScroll: true });
            }
            else {
                const nextElem = this.getRowByIndex(rowIndex, '');
                nextElem.focus({ preventScroll: true });
            }
        };
        if (this.shouldPerformVerticalScroll(rowIndex, nextElementColumn.visibleIndex)) {
            this.grid.nativeElement.focus({ preventScroll: true });
            this.performVerticalScrollToCell(rowIndex, nextElementColumn.visibleIndex, cb);
        }
        else {
            cb();
        }
    }
    focusNextCellFromLayout(cellElement, selectedNode) {
        const parentIndex = selectedNode.column;
        let columnLayout = this.grid.columns.find(x => x.columnLayout && x.visibleIndex === parentIndex);
        const currentColEnd = selectedNode.layout.colEnd || selectedNode.layout.colStart + 1;
        const currentRowStart = this.applyNavigationCell(selectedNode.layout.colStart, selectedNode.layout.rowStart, NavigationDirection.horizontal);
        const rowIndex = selectedNode.row;
        // check if next element is from the same layout
        let nextElementColumn = columnLayout.children.find(c => c.colStart === currentColEnd &&
            c.rowStart <= currentRowStart &&
            (currentRowStart < c.rowEnd || currentRowStart < c.rowStart + c.gridRowSpan));
        if (!nextElementColumn) {
            // no next column in current layout, search for next layout
            columnLayout = this.grid.columns.find(c => c.columnLayout && !c.hidden && c.visibleIndex === columnLayout.visibleIndex + 1);
            if (!columnLayout) {
                // reached the end
                return null;
            }
            // next element is from the next layout
            nextElementColumn = columnLayout.children.find(c => c.colStart === 1 &&
                c.rowStart <= currentRowStart &&
                (currentRowStart < c.rowEnd || currentRowStart < c.rowStart + c.gridRowSpan));
        }
        const cb = () => {
            const nextElement = nextElementColumn.cells.find((c) => c.rowIndex === rowIndex).nativeElement;
            this._focusCell(nextElement);
        };
        if (!this.isColumnRightEdgeVisible(nextElementColumn.visibleIndex)) {
            this.grid.nativeElement.focus({ preventScroll: true });
            this.performHorizontalScrollToCell(rowIndex, nextElementColumn.visibleIndex, false, cb);
        }
        else {
            cb();
        }
    }
    focusPrevCellFromLayout(cellElement, selectedNode) {
        const parentIndex = selectedNode.column;
        let columnLayout = this.grid.columns.find(x => x.columnLayout && x.visibleIndex === parentIndex);
        const currentColStart = selectedNode.layout.colStart;
        const currentRowStart = this.applyNavigationCell(currentColStart, selectedNode.layout.rowStart, NavigationDirection.horizontal);
        const rowIndex = selectedNode.row;
        // check previous element is from the same layout
        let prevElementColumn = columnLayout.children
            .find(c => (c.colEnd === currentColStart || c.colStart + c.gridColumnSpan === currentColStart) &&
            c.rowStart <= currentRowStart &&
            (currentRowStart < c.rowEnd || currentRowStart < c.rowStart + c.gridRowSpan));
        if (!prevElementColumn) {
            // no prev column in current layout, seacrh for prev layout
            columnLayout = this.grid.columns.find(c => c.columnLayout && !c.hidden && c.visibleIndex === columnLayout.visibleIndex - 1);
            if (!columnLayout) {
                // reached the end
                return null;
            }
            const layoutSize = columnLayout.getInitialChildColumnSizes(columnLayout.children).length;
            // first element is from the next layout
            prevElementColumn = columnLayout.children
                .find(c => (c.colEnd === layoutSize + 1 || c.colStart + c.gridColumnSpan === layoutSize + 1) &&
                c.rowStart <= currentRowStart &&
                (currentRowStart < c.rowEnd || currentRowStart < c.rowStart + c.gridRowSpan));
        }
        const cb = () => {
            const prevElement = prevElementColumn.cells.find((c) => c.rowIndex === rowIndex).nativeElement;
            this._focusCell(prevElement);
        };
        if (!this.isColumnLeftEdgeVisible(prevElementColumn.visibleIndex)) {
            this.grid.nativeElement.focus({ preventScroll: true });
            this.performHorizontalScrollToCell(rowIndex, prevElementColumn.visibleIndex, false, cb);
        }
        else {
            cb();
        }
    }
    onKeydownEnd(rowIndex, isSummary = false, cellRowStart) {
        const layouts = this.grid.columns.filter(c => c.columnLayout && !c.hidden).sort((a, b) => a.visibleIndex - b.visibleIndex);
        const lastLayout = layouts[layouts.length - 1];
        const lastLayoutChildren = lastLayout.children;
        const layoutSize = lastLayout.getInitialChildColumnSizes(lastLayoutChildren).length;
        const currentRowStart = this.applyNavigationCell(this.startNavigationCell ? this.startNavigationCell.colStart : 1, cellRowStart || this.grid.multiRowLayoutRowSize, NavigationDirection.horizontal);
        const nextElementColumn = lastLayout.children.find(c => (c.colEnd === layoutSize + 1 || c.colStart + c.gridColumnSpan === layoutSize + 1) &&
            c.rowStart <= currentRowStart &&
            (currentRowStart < c.rowEnd || currentRowStart < c.rowStart + c.gridRowSpan));
        const indexInLayout = lastLayoutChildren.toArray().indexOf(nextElementColumn);
        const rowList = isSummary ? this.grid.summariesRowList : this.grid.dataRowList;
        let rowElement = rowList.find((row) => row.index === rowIndex);
        if (!rowElement) {
            return;
        }
        rowElement = rowElement.nativeElement;
        if (!this.isColumnRightEdgeVisible(nextElementColumn.visibleIndex)) {
            this.grid.nativeElement.focus({ preventScroll: true });
            const cb = () => {
                const allBlocks = rowElement.querySelectorAll(this.getColumnLayoutSelector());
                const cell = allBlocks[allBlocks.length - 1].children[indexInLayout];
                this._focusCell(cell);
            };
            this.performHorizontalScrollToCell(rowIndex, nextElementColumn.visibleIndex, false, cb);
            return;
        }
        else {
            const allBlocks = rowElement.querySelectorAll(this.getColumnLayoutSelector());
            const cell = allBlocks[allBlocks.length - 1].children[indexInLayout];
            this._focusCell(cell);
        }
    }
    onKeydownHome(rowIndex, isSummary = false, cellRowStart = 1) {
        const firstLayout = this.grid.columns.filter(c => c.columnLayout && !c.hidden)[0];
        const lastLayoutChildren = firstLayout.children.toArray();
        const currentRowStart = this.applyNavigationCell(this.startNavigationCell ? this.startNavigationCell.colStart : 1, cellRowStart, NavigationDirection.horizontal);
        const nextElementColumn = firstLayout.children.find(c => c.colStart === 1 &&
            c.rowStart <= currentRowStart &&
            (currentRowStart < c.rowEnd || currentRowStart < c.rowStart + c.gridRowSpan));
        const indexInLayout = lastLayoutChildren.indexOf(nextElementColumn);
        const rowList = isSummary ? this.grid.summariesRowList : this.grid.dataRowList;
        let rowElement = rowList.find((row) => row.index === rowIndex);
        if (!rowElement) {
            return;
        }
        rowElement = rowElement.nativeElement;
        if (!this.isColumnLeftEdgeVisible(nextElementColumn.visibleIndex)) {
            this.grid.nativeElement.focus({ preventScroll: true });
            const cb = () => {
                const allBlocks = rowElement.querySelectorAll(this.getColumnLayoutSelector());
                const cell = allBlocks[0].children[indexInLayout];
                this._focusCell(cell);
            };
            this.performHorizontalScrollToCell(rowIndex, nextElementColumn.visibleIndex, false, cb);
            return;
        }
        else {
            const allBlocks = rowElement.querySelectorAll(this.getColumnLayoutSelector());
            const cell = allBlocks[0].children[indexInLayout];
            this._focusCell(cell);
        }
    }
    getColumnLayoutSelector() {
        return '.igx-grid__mrl-block';
    }
    getChildColumnScrollPositions(visibleColIndex) {
        const forOfDir = this.grid.dataRowList.length > 0 ? this.grid.dataRowList.first.virtDirRow : this.grid.headerContainer;
        const targetCol = this.getColunmByVisibleIndex(visibleColIndex);
        const parent = targetCol.parent;
        const parentVIndex = forOfDir.igxForOf.indexOf(parent);
        let leftScroll = forOfDir.getColumnScrollLeft(parentVIndex), rightScroll = 0;
        // caculate offset from parent based on target column colStart and colEnd and the resolved child column sizes.
        const childSizes = parent.getFilledChildColumnSizes(parent.children);
        const colStart = targetCol.colStart || 1;
        const colEnd = targetCol.colEnd || colStart + 1;
        for (let i = 1; i < colStart; i++) {
            leftScroll += parseInt(childSizes[i - 1], 10);
        }
        rightScroll += leftScroll;
        for (let j = colStart; j < colEnd; j++) {
            rightScroll += parseInt(childSizes[j - 1], 10);
        }
        return { leftScroll, rightScroll };
    }
    getColunmByVisibleIndex(visibleColIndex) {
        visibleColIndex = visibleColIndex < 0 ? 0 : visibleColIndex;
        return this.grid.columnList.find((col) => !col.columnLayout && col.visibleIndex === visibleColIndex);
    }
    shouldPerformVerticalScroll(rowIndex, visibleColumnIndex) {
        if (this._isGroupRecordAt(rowIndex) || this._isDetailRecordAt(rowIndex)) {
            return super.shouldPerformVerticalScroll(rowIndex, visibleColumnIndex);
        }
        if (!super.shouldPerformVerticalScroll(rowIndex, visibleColumnIndex)) {
            return false;
        }
        const targetRow = this.grid.summariesRowList.filter(s => s.index !== 0)
            .concat(this.grid.rowList.toArray()).find(r => r.index === rowIndex);
        const scrollTop = Math.abs(this.grid.verticalScrollContainer.getScroll().scrollTop);
        const containerHeight = this.grid.calcHeight ? Math.ceil(this.grid.calcHeight) : 0;
        const scrollPos = this.getVerticalScrollPositions(rowIndex, visibleColumnIndex);
        if (!targetRow || targetRow.nativeElement.offsetTop + scrollPos.topOffset < Math.abs(this.verticalDCTopOffset)
            || containerHeight && containerHeight < scrollPos.rowBottom - scrollTop) {
            return true;
        }
        else {
            return false;
        }
    }
    get verticalDCTopOffset() {
        return parseInt(this.grid.verticalScrollContainer.dc.instance._viewContainer.element.nativeElement.style.top, 10);
    }
    _isGroupRecordAt(rowIndex) {
        const record = this.grid.dataView[rowIndex];
        return record.records && record.records.length;
    }
    _isDetailRecordAt(rowIndex) {
        const record = this.grid.dataView[rowIndex];
        return this.grid.isDetailRecord(record);
    }
    performVerticalScrollToCell(rowIndex, visibleColumnIndex, cb) {
        if (this._isGroupRecordAt(rowIndex) || this._isDetailRecordAt(rowIndex)) {
            return super.performVerticalScrollToCell(rowIndex, visibleColumnIndex, cb);
        }
        const containerHeight = this.grid.calcHeight ? Math.ceil(this.grid.calcHeight) : 0;
        const scrollTop = Math.abs(this.grid.verticalScrollContainer.getScroll().scrollTop);
        const scrollPos = this.getVerticalScrollPositions(rowIndex, visibleColumnIndex);
        const targetRow = this.grid.summariesRowList.filter(s => s.index !== 0)
            .concat(this.grid.rowList.toArray()).find(r => r.index === rowIndex);
        const isPrevious = (scrollTop > scrollPos.rowTop) && (!targetRow ||
            targetRow.nativeElement.offsetTop + scrollPos.topOffset < Math.abs(this.verticalDCTopOffset));
        const scrollAmount = isPrevious ? scrollPos.rowTop : Math.abs(scrollTop + containerHeight - scrollPos.rowBottom);
        this.grid.verticalScrollContainer.onChunkLoad
            .pipe(first()).subscribe(() => {
            cb();
        });
        if (isPrevious) {
            this.grid.verticalScrollContainer.scrollPosition = scrollAmount;
        }
        else {
            this.grid.verticalScrollContainer.addScrollTop(scrollAmount);
        }
    }
    getVerticalScrollPositions(rowIndex, visibleColIndex) {
        const targetCol = this.getColunmByVisibleIndex(visibleColIndex);
        const topOffset = (targetCol.rowStart - 1) * this.grid.defaultRowHeight;
        const rowTop = this.grid.verticalScrollContainer.sizesCache[rowIndex] + topOffset;
        const rowBottom = rowTop + (this.grid.defaultRowHeight * targetCol.gridRowSpan);
        return { rowTop, rowBottom, topOffset };
    }
    performHorizontalScrollToCell(rowIndex, visibleColumnIndex, isSummary = false, cb) {
        const scrollPos = this.getChildColumnScrollPositions(visibleColumnIndex);
        const hScroll = this.horizontalScroll(rowIndex);
        this.grid.parentVirtDir.onChunkLoad
            .pipe(first())
            .subscribe(() => {
            if (cb) {
                cb();
            }
            else {
                this._focusCell(this.getCellElementByVisibleIndex(rowIndex, visibleColumnIndex, isSummary));
            }
        });
        const isPrevItem = hScroll.getScroll().scrollLeft > scrollPos.leftScroll;
        const containerSize = parseInt(hScroll.igxForContainerSize, 10);
        const nextScroll = isPrevItem ? scrollPos.leftScroll : scrollPos.rightScroll - containerSize;
        hScroll.scrollPosition = nextScroll;
    }
    _focusCell(cellElem) {
        // in case of variable row heights in mrl grid make sure cell is really in view after it has been rendered.
        const gridBoundingClientRect = this.grid.tbody.nativeElement.getBoundingClientRect();
        const diffTop = cellElem.getBoundingClientRect().top - gridBoundingClientRect.top;
        const diffBottom = cellElem.getBoundingClientRect().bottom - gridBoundingClientRect.bottom;
        if (diffTop < 0) {
            // cell is above grid top - not visible
            this.grid.nativeElement.focus({ preventScroll: true });
            this.grid.verticalScrollContainer.onChunkLoad
                .pipe(first())
                .subscribe(() => {
                cellElem.focus({ preventScroll: true });
            });
            this.grid.verticalScrollContainer.addScrollTop(diffTop);
        }
        else if (diffBottom > 0) {
            // cell is below grid bottom - not visible
            this.grid.nativeElement.focus({ preventScroll: true });
            this.grid.verticalScrollContainer.onChunkLoad
                .pipe(first())
                .subscribe(() => {
                cellElem.focus({ preventScroll: true });
            });
            this.grid.verticalScrollContainer.addScrollTop(diffBottom);
        }
        else {
            // cell is visible
            cellElem.focus({ preventScroll: true });
        }
    }
    goToFirstCell() {
        this.startNavigationCell = null;
        super.goToFirstCell();
    }
    goToLastCell() {
        this.startNavigationCell = null;
        super.goToLastCell();
    }
};
IgxGridMRLNavigationService = __decorate([
    Injectable()
], IgxGridMRLNavigationService);
export { IgxGridMRLNavigationService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3JpZC1tcmwtbmF2aWdhdGlvbi5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vaWduaXRldWktYW5ndWxhci8iLCJzb3VyY2VzIjpbImxpYi9ncmlkcy9ncmlkLW1ybC1uYXZpZ2F0aW9uLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFM0MsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRXZDLE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBVXJFLE1BQU0sQ0FBTixJQUFZLG1CQUdYO0FBSEQsV0FBWSxtQkFBbUI7SUFDM0IsZ0RBQXlCLENBQUE7SUFDekIsNENBQXFCLENBQUE7QUFDekIsQ0FBQyxFQUhXLG1CQUFtQixLQUFuQixtQkFBbUIsUUFHOUI7QUFHRCxjQUFjO0FBRWQsSUFBYSwyQkFBMkIsR0FBeEMsTUFBYSwyQkFBNEIsU0FBUSx3QkFBd0I7SUFNckU7OztPQUdHO0lBQ0ksc0JBQXNCLENBQUMsUUFBZ0IsRUFBRSxRQUFnQixFQUFFLEdBQXdCO1FBQ3RGLElBQUksQ0FBQyxtQkFBbUIsR0FBRztZQUN2QixRQUFRLEVBQUUsUUFBUTtZQUNsQixRQUFRLEVBQUUsUUFBUTtZQUNsQixTQUFTLEVBQUUsR0FBRztTQUNqQixDQUFDO0lBQ04sQ0FBQztJQUVPLG1CQUFtQixDQUFDLFFBQWdCLEVBQUUsUUFBZ0IsRUFBRSxZQUFpQztRQUM3RixNQUFNLFdBQVcsR0FBRyxZQUFZLEtBQUssbUJBQW1CLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDL0QsbUJBQW1CLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxtQkFBbUIsQ0FBQyxRQUFRLENBQUM7UUFDbEUsSUFBSSxJQUFJLENBQUMsbUJBQW1CLElBQUksSUFBSSxDQUFDLG1CQUFtQixDQUFDLFNBQVMsS0FBSyxZQUFZLEVBQUU7WUFDakYsSUFBSSxDQUFD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LENBQUMsdUJBQXVCLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1NBQzNEO2FBQU0sSUFBSSxVQUFVLEdBQUcsQ0FBQyxFQUFFO1lBQ3ZCLDBDQUEwQztZQUMxQyxJQUFJLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsRUFBRSxhQUFhLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztZQUN2RCxJQUFJLENBQUMsSUFBSSxDQUFDLHVCQUF1QixDQUFDLFdBQVc7aUJBQ3hDLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztpQkFDYixTQUFTLENBQUMsR0FBRyxFQUFFO2dCQUNaLFFBQVEsQ0FBQyxLQUFLLENBQUMsRUFBRSxhQUFhLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztZQUNoRCxDQUFDLENBQUMsQ0FBQztZQUNILElBQUksQ0FBQyxJQUFJLENBQUMsdUJBQXVCLENBQUMsWUFBWSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1NBQzlEO2FBQU87WUFDSixrQkFBa0I7WUFDbEIsUUFBUSxDQUFDLEtBQUssQ0FBQyxFQUFFLGFBQWEsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO1NBQzNDO0lBQ0wsQ0FBQztJQUVNLGFBQWE7UUFDaEIsSUFBSSxDQUFDLG1CQUFtQixHQUFHLElBQUksQ0FBQztRQUNoQyxLQUFLLENBQUMsYUFBYSxFQUFFLENBQUM7SUFDMUIsQ0FBQztJQUVNLFlBQVk7UUFDZixJQUFJLENBQUMsbUJBQW1CLEdBQUcsSUFBSSxDQUFDO1FBQ2hDLEtBQUssQ0FBQyxZQUFZLEVBQUUsQ0FBQztJQUN6QixDQUFDO0NBQ0osQ0FBQTtBQTFpQlksMkJBQTJCO0lBRHZDLFVBQVUsRUFBRTtHQUNBLDJCQUEyQixDQTBpQnZDO1NBMWlCWSwyQkFBMkIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBJZ3hHcmlkQmFzZURpcmVjdGl2ZSB9IGZyb20gJy4vZ3JpZC1iYXNlLmRpcmVjdGl2ZSc7XG5pbXBvcnQgeyBmaXJzdCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IElneENvbHVtbkNvbXBvbmVudCB9IGZyb20gJy4vY29sdW1ucy9jb2x1bW4uY29tcG9uZW50JztcbmltcG9ydCB7IElneEdyaWROYXZpZ2F0aW9uU2VydmljZSB9IGZyb20gJy4vZ3JpZC1uYXZpZ2F0aW9uLnNlcnZpY2UnO1xuaW1wb3J0IHsgSVNlbGVjdGlvbk5vZGUgfSBmcm9tICcuL3NlbGVjdGlvbi9zZWxlY3Rpb24uc2VydmljZSc7XG5cblxuZXhwb3J0IGludGVyZmFjZSBJU3RhcnROYXZpZ2F0aW9uQ2VsbCB7XG4gICAgcm93U3RhcnQ6IG51bWJlcjtcbiAgICBjb2xTdGFydDogbnVtYmVyO1xuICAgIGRpcmVjdGlvbjogTmF2aWdhdGlvbkRpcmVjdGlvbjtcbn1cblxuZXhwb3J0IGVudW0gTmF2aWdhdGlvbkRpcmVjdGlvbiB7XG4gICAgaG9yaXpvbnRhbCA9ICdob3Jpem9udGFsJyxcbiAgICB2ZXJ0aWNhbCA9ICd2ZXJ0aWNhbCdcbn1cblxuXG4vKiogQGhpZGRlbiAqL1xuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIElneEdyaWRNUkxOYXZpZ2F0aW9uU2VydmljZSBleHRlbmRzIElneEdyaWROYXZpZ2F0aW9uU2VydmljZSB7XG5cbiAgICBwcml2YXRlIHN0YXJ0TmF2aWdhdGlvbkNlbGw6IElTdGFydE5hdmlnYXRpb25DZWxsO1xuXG4gICAgcHVibGljIGdyaWQ6IElneEdyaWRCYXNlRGlyZWN0aXZlO1xuXG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIHB1YmxpYyBzZXRTdGFydE5hdmlnYXRpb25DZWxsKGNvbFN0YXJ0OiBudW1iZXIsIHJvd1N0YXJ0OiBudW1iZXIsIGRpcjogTmF2aWdhdGlvbkRpcmVjdGlvbikge1xuICAgICAgICB0aGlzLnN0YXJ0TmF2aWdhdGlvbkNlbGwgPSB7XG4gICAgICAgICAgICBjb2xTdGFydDogY29sU3RhcnQsXG4gICAgICAgICAgICByb3dTdGFydDogcm93U3RhcnQsXG4gICAgICAgICAgICBkaXJlY3Rpb246IGRpclxuICAgICAgICB9O1xuICAgIH1cblxuICAgIHByaXZhdGUgYXBwbHlOYXZpZ2F0aW9uQ2VsbChjb2xTdGFydDogbnVtYmVyLCByb3dTdGFydDogbnVtYmVyLCBuYXZEaXJlY3Rpb246IE5hdmlnYXRpb25EaXJlY3Rpb24pOiBudW1iZXIge1xuICAgICAgICBjb25zdCBvcHBvc2l0ZURpciA9IG5hdkRpcmVjdGlvbiA9PT0gTmF2aWdhdGlvbkRpcmVjdGlvbi52ZXJ0aWNhbCA/XG4gICAgICAgICAgICBOYXZpZ2F0aW9uRGlyZWN0aW9uLmhvcml6b250YWwgOiBOYXZpZ2F0aW9uRGlyZWN0aW9uLnZlcnRpY2FsO1xuICAgICAgICBpZiAodGhpcy5zdGFydE5hdmlnYXRpb25DZWxsICYmIHRoaXMuc3RhcnROYXZpZ2F0aW9uQ2VsbC5kaXJlY3Rpb24gIT09IG5hdkRpcmVjdGlvbikge1xuICAgICAgICAgICAgdGhpcy5zdGFydE5hdmlnYXRpb25DZWxsLmRpcmVjdGlvbiA9IG9wcG9zaXRlRGlyO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGFydE5hdmlnYXRpb25DZWxsKGNvbFN0YXJ0LCByb3dTdGFydCwgb3Bwb3NpdGVEaXIpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG5hdkRpcmVjdGlvbiA9PT0gTmF2aWdhdGlvbkRpcmVjdGlvbi52ZXJ0aWNhbCA/XG4gICAgICAgICAgICB0aGlzLnN0YXJ0TmF2aWdhdGlvbkNlbGwuY29sU3RhcnQgOiB0aGlzLnN0YXJ0TmF2aWdhdGlvbkNlbGwucm93U3RhcnQ7XG4gICAgfVxuXG4gICAgcHVibGljIG5hdmlnYXRlVXAocm93RWxlbWVudDogSFRNTEVsZW1lbnQsIHNlbGVjdGVkTm9kZTogSVNlbGVjdGlvbk5vZGUpIHtcbiAgICAgICAgdGhpcy5mb2N1c0NlbGxVcEZyb21MYXlvdXQocm93RWxlbWVudCwgc2VsZWN0ZWROb2RlKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgbmF2aWdhdGVEb3duKHJvd0VsZW1lbnQ6IEhUTUxFbGVtZW50LCBzZWxlY3RlZE5vZGU6IElTZWxlY3Rpb25Ob2RlKSB7XG4gICAgICAgIHRoaXMuZm9jdXNDZWxsRG93bkZyb21MYXlvdXQocm93RWxlbWVudCwgc2VsZWN0ZWROb2RlKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgaXNDb2x1bW5SaWdodEVkZ2VWaXNpYmxlKHZpc2libGVDb2x1bW5JbmRleDogbnVtYmVyKTogYm9vbGVhbiB7XG4gICAgICAgIGNvbnN0IGNvbHVtbiA9IHRoaXMuZ3JpZC5jb2x1bW5MaXN0LmZpbHRlcihjID0+ICFjLmNvbHVtbkdyb3VwKS5maW5kKChjb2wpID0+IGNvbC52aXNpYmxlSW5kZXggPT09IHZpc2libGVDb2x1bW5JbmRleCk7XG4gICAgICAgIGNvbnN0IGZvck9mRGlyID0gIHRoaXMuZ3JpZC5oZWFkZXJDb250YWluZXI7XG4gICAgICAgIGNvbnN0IGhvcml6b250YWxTY3JvbGwgPSBmb3JPZkRpci5nZXRTY3JvbGwoKTtcbiAgICAgICAgaWYgKCFob3Jpem9udGFsU2Nyb2xsLmNsaWVudFdpZHRoIHx8IChjb2x1bW4gJiYgY29sdW1uLnBpbm5lZCkpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9IGVsc2UgaWYgKGNvbHVtbikge1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNQYXJlbnRDb2x1bW5GdWxseVZpc2libGUoY29sdW1uKSkgeyByZXR1cm4gdHJ1ZTsgfVxuICAgICAgICAgICAgY29uc3Qgc2Nyb2xsUG9zID0gdGhpcy5nZXRDaGlsZENvbHVtblNjcm9sbFBvc2l0aW9ucyh2aXNpYmxlQ29sdW1uSW5kZXgpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGlzcGxheUNvbnRhaW5lcldpZHRoID49IHNjcm9sbFBvcy5yaWdodFNjcm9sbCAtIHRoaXMuZGlzcGxheUNvbnRhaW5lclNjcm9sbExlZnQgJiZcbiAgICAgICAgICAgIHRoaXMuZGlzcGxheUNvbnRhaW5lclNjcm9sbExlZnQgPD0gc2Nyb2xsUG9zLmxlZnRTY3JvbGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBwcml2YXRlIGlzUGFyZW50Q29sdW1uRnVsbHlWaXNpYmxlKHBhcmVudDogSWd4Q29sdW1uQ29tcG9uZW50KTogYm9vbGVhbiB7XG4gICAgICAgIGNvbnN0IGZvck9mRGlyID0gdGhpcy5ncmlkLmRhdGFSb3dMaXN0Lmxlbmd0aCA+IDAgPyB0aGlzLmdyaWQuZGF0YVJvd0xpc3QuZmlyc3QudmlydERpclJvdyA6IHRoaXMuZ3JpZC5oZWFkZXJDb250YWluZXI7XG4gICAgICAgIGNvbnN0IGhvcml6b250YWxTY3JvbGwgPSBmb3JPZkRpci5nZXRTY3JvbGwoKTtcbiAgICAgICAgaWYgKCFob3Jpem9udGFsU2Nyb2xsLmNsaWVudFdpZHRoIHx8IHBhcmVudC5waW5uZWQpIHsgcmV0dXJuIHRydWU7IH1cbiAgICAgICAgY29uc3QgaW5kZXggPSBmb3JPZkRpci5pZ3hGb3JPZi5pbmRleE9mKHBhcmVudCk7XG4gICAgICAgIHJldHVybiB0aGlzLmRpc3BsYXlDb250YWluZXJXaWR0aCA+PSBmb3JPZkRpci5nZXRDb2x1bW5TY3JvbGxMZWZ0KGluZGV4ICsgMSkgLSB0aGlzLmRpc3BsYXlDb250YWluZXJTY3JvbGxMZWZ0ICYmXG4gICAgICAgICAgICB0aGlzLmRpc3BsYXlDb250YWluZXJTY3JvbGxMZWZ0IDw9IGZvck9mRGlyLmdldENvbHVtblNjcm9sbExlZnQoaW5kZXgpO1xuICAgIH1cblxuICAgIHB1YmxpYyBpc0NvbHVtbkxlZnRFZGdlVmlzaWJsZSh2aXNpYmxlQ29sdW1uSW5kZXg6IG51bWJlcik6IGJvb2xlYW4ge1xuICAgICAgICBjb25zdCBmb3JPZkRpciA9IHRoaXMuZ3JpZC5oZWFkZXJDb250YWluZXI7XG4gICAgICAgIGNvbnN0IGhvcml6b250YWxTY3JvbGwgPSBmb3JPZkRpci5nZXRTY3JvbGwoKTtcbiAgICAgICAgY29uc3QgY29sdW1uID0gdGhpcy5ncmlkLmNvbHVtbkxpc3QuZmlsdGVyKGMgPT4gIWMuY29sdW1uR3JvdXApLmZpbmQoKGNvbCkgPT4gY29sLnZpc2libGVJbmRleCA9PT0gdmlzaWJsZUNvbHVtbkluZGV4KTtcbiAgICAgICAgaWYgKCFob3Jpem9udGFsU2Nyb2xsLmNsaWVudFdpZHRoIHx8IGNvbHVtbi5waW5uZWQpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmlzUGFyZW50Q29sdW1uRnVsbHlWaXNpYmxlKGNvbHVtbikpIHsgcmV0dXJuIHRydWU7IH1cbiAgICAgICAgY29uc3Qgc2Nyb2xsUG9zID0gdGhpcy5nZXRDaGlsZENvbHVtblNjcm9sbFBvc2l0aW9ucyh2aXNpYmxlQ29sdW1uSW5kZXgpO1xuICAgICAgICByZXR1cm4gdGhpcy5kaXNwbGF5Q29udGFpbmVyU2Nyb2xsTGVmdCA8PSBzY3JvbGxQb3MubGVmdFNjcm9sbDtcbiAgICB9XG5cbiAgICBwdWJsaWMgb25LZXlkb3duQXJyb3dSaWdodChlbGVtZW50OiBIVE1MRWxlbWVudCwgc2VsZWN0ZWROb2RlOiBJU2VsZWN0aW9uTm9kZSkge1xuICAgICAgICB0aGlzLmZvY3VzTmV4dENlbGxGcm9tTGF5b3V0KGVsZW1lbnQsIHNlbGVjdGVkTm9kZSk7XG4gICAgfVxuXG4gICAgcHVibGljIG9uS2V5ZG93bkFycm93TGVmdChlbGVtZW50OiBIVE1MRWxlbWVudCwgc2VsZWN0ZWROb2RlOiBJU2VsZWN0aW9uTm9kZSkge1xuICAgICAgICB0aGlzLmZvY3VzUHJldkNlbGxGcm9tTGF5b3V0KGVsZW1lbnQsIHNlbGVjdGVkTm9kZSk7XG4gICAgfVxuICAgIHB1YmxpYyBnZXQgZ3JpZE9yZGVyZWRDb2x1bW5zKCk6IElneENvbHVtbkNvbXBvbmVudFtdIHtcbiAgICAgICAgcmV0dXJuIFsuLi50aGlzLmdyaWQucGlubmVkQ29sdW1ucywgLi4udGhpcy5ncmlkLnVucGlubmVkQ29sdW1uc10uZmlsdGVyKGMgPT4gIWMuY29sdW1uR3JvdXApXG4gICAgICAgIC5zb3J0KChhLCBiKSA9PiBhLnZpc2libGVJbmRleCAtIGIudmlzaWJsZUluZGV4KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgcGVyZm9ybVRhYihjdXJyZW50Um93RWw6IEhUTUxFbGVtZW50LCBzZWxlY3RlZE5vZGU6IElTZWxlY3Rpb25Ob2RlKSB7XG4gICAgICAgIGNvbnN0IHZpc2libGVDb2x1bW5JbmRleCA9IHNlbGVjdGVkTm9kZS5sYXlvdXQgPyBzZWxlY3RlZE5vZGUubGF5b3V0LmNvbHVtblZpc2libGVJbmRleCA6IDA7XG4gICAgICAgIGNvbnN0IG5leHRFbGVtZW50Q29sdW1uID0gdGhpcy5ncmlkLmNvbHVtbnMuZmluZCh4ID0+ICF4LmNvbHVtbkdyb3VwICYmIHgudmlzaWJsZUluZGV4ID09PSB2aXNpYmxlQ29sdW1uSW5kZXggKyAxKTtcbiAgICAgICAgY29uc3Qgcm93SW5kZXggPSBzZWxlY3RlZE5vZGUucm93O1xuICAgICAgICBjb25zdCByb3cgPSB0aGlzLmdyaWQuZ2V0Um93QnlJbmRleChyb3dJbmRleCk7XG4gICAgICAgIHRoaXMuX21vdmVGb2N1c1RvQ2VsbChjdXJyZW50Um93RWwsIG5leHRFbGVtZW50Q29sdW1uLCByb3csIHNlbGVjdGVkTm9kZSwgJ25leHQnKTtcbiAgICAgICAgaWYgKG5leHRFbGVtZW50Q29sdW1uKSB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXJ0TmF2aWdhdGlvbkNlbGwobmV4dEVsZW1lbnRDb2x1bW4uY29sU3RhcnQsIG5leHRFbGVtZW50Q29sdW1uLnJvd1N0YXJ0LCBudWxsKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByb3RlY3RlZCBfbW92ZUZvY3VzVG9DZWxsKGN1cnJlbnRSb3dFbDogSFRNTEVsZW1lbnQsIG5leHRFbGVtZW50Q29sdW1uLCByb3csIHNlbGVjdGVkTm9kZSwgZGlyKSB7XG4gICAgICAgIGlmIChuZXh0RWxlbWVudENvbHVtbiAmJiByb3cuY2VsbHMpIHtcbiAgICAgICAgICAgIGxldCBuZXh0Q2VsbCA9IHJvdy5jZWxscy5maW5kKGN1cnJDZWxsID0+IGN1cnJDZWxsLmNvbHVtbiA9PT0gbmV4dEVsZW1lbnRDb2x1bW4pO1xuICAgICAgICAgICAgY29uc3QgaXNWaXNpYmxlID0gdGhpcy5pc0NvbHVtblJpZ2h0RWRnZVZpc2libGUobmV4dEVsZW1lbnRDb2x1bW4udmlzaWJsZUluZGV4KTtcbiAgICAgICAgICAgIGlmICghbmV4dENlbGwgfHwgIWlzVmlzaWJsZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JpZC5uYXRpdmVFbGVtZW50LmZvY3VzKHsgcHJldmVudFNjcm9sbDogdHJ1ZSB9KTtcbiAgICAgICAgICAgICAgICBjb25zdCBjYiA9ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgbmV4dENlbGwgPSByb3cuY2VsbHMuZmluZChjdXJyQ2VsbCA9PiBjdXJyQ2VsbC5jb2x1bW4gPT09IG5leHRFbGVtZW50Q29sdW1uKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZ3JpZC5yb3dFZGl0YWJsZSAmJiB0aGlzLmlzUm93SW5FZGl0TW9kZShyb3cuaW5kZXgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGlyID09PSAnbmV4dCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vdmVOZXh0RWRpdGFibGUocm93LmluZGV4LCBzZWxlY3RlZE5vZGUubGF5b3V0LmNvbHVtblZpc2libGVJbmRleCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW92ZVByZXZpb3VzRWRpdGFibGUocm93LmluZGV4LCBzZWxlY3RlZE5vZGUubGF5b3V0LmNvbHVtblZpc2libGVJbmRleCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZm9jdXNDZWxsKG5leHRDZWxsLm5hdGl2ZUVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgdGhpcy5wZXJmb3JtSG9yaXpvbnRhbFNjcm9sbFRvQ2VsbChyb3cuaW5kZXgsIG5leHRFbGVtZW50Q29sdW1uLnZpc2libGVJbmRleCwgZmFsc2UsIGNiKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZ3JpZC5yb3dFZGl0YWJsZSAmJiB0aGlzLmlzUm93SW5FZGl0TW9kZShyb3cuaW5kZXgpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkaXIgPT09ICduZXh0Jykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3ZlTmV4dEVkaXRhYmxlKHJvdy5pbmRleCwgc2VsZWN0ZWROb2RlLmxheW91dC5jb2x1bW5WaXNpYmxlSW5kZXgpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3ZlUHJldmlvdXNFZGl0YWJsZShyb3cuaW5kZXgsIHNlbGVjdGVkTm9kZS5sYXlvdXQuY29sdW1uVmlzaWJsZUluZGV4KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuX2ZvY3VzQ2VsbChuZXh0Q2VsbC5uYXRpdmVFbGVtZW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIGVuZCBvZiBsYXlvdXQgcmVhY2hlZFxuICAgICAgICAgICAgaWYgKHRoaXMuaXNSb3dJbkVkaXRNb2RlKHJvdy5pbmRleCkpIHtcbiAgICAgICAgICAgICAgICAvLyAgVE9ETzogbWFrZSBncmlkQVBJIHZpc2libGUgZm9yIGludGVybmFsIHVzZSBhbmQgcmVtb3ZlIGNhc3QgdG8gYW55XG4gICAgICAgICAgICAgICAgKHRoaXMuZ3JpZCBhcyBhbnkpLmdyaWRBUEkuc3VibWl0X3ZhbHVlKCk7XG4gICAgICAgICAgICAgICAgaWYgKGRpciA9PT0gJ25leHQnKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ3JpZC5yb3dFZGl0VGFicy5maXJzdC5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQuZm9jdXMoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmdyaWQucm93RWRpdFRhYnMubGFzdC5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQuZm9jdXMoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGRpciA9PT0gJ25leHQnKSB7XG4gICAgICAgICAgICAgICAgc3VwZXIubmF2aWdhdGVEb3duKGN1cnJlbnRSb3dFbCwge3Jvdzogcm93LmluZGV4LCBjb2x1bW46IDB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgIGxldCBsYXN0VmlzaWJsZUluZGV4ID0gMDtcbiAgICAgICAgICAgICAgICB0aGlzLmdyaWQudW5waW5uZWRDb2x1bW5zLmZvckVhY2goKGNvbCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBsYXN0VmlzaWJsZUluZGV4ID0gTWF0aC5tYXgobGFzdFZpc2libGVJbmRleCwgY29sLnZpc2libGVJbmRleCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgc3VwZXIubmF2aWdhdGVVcChjdXJyZW50Um93RWwsIHtyb3c6IHJvdy5pbmRleCwgY29sdW1uOiBsYXN0VmlzaWJsZUluZGV4fSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgcGVyZm9ybVNoaWZ0VGFiS2V5KGN1cnJlbnRSb3dFbDogSFRNTEVsZW1lbnQsIHNlbGVjdGVkTm9kZTogSVNlbGVjdGlvbk5vZGUpIHtcbiAgICAgICAgY29uc3QgdmlzaWJsZUNvbHVtbkluZGV4ID0gc2VsZWN0ZWROb2RlLmxheW91dCA/IHNlbGVjdGVkTm9kZS5sYXlvdXQuY29sdW1uVmlzaWJsZUluZGV4IDogMDtcbiAgICAgICAgY29uc3Qgcm93SW5kZXggPSBzZWxlY3RlZE5vZGUucm93O1xuICAgICAgICBjb25zdCByb3cgPSB0aGlzLmdyaWQuZ2V0Um93QnlJbmRleChyb3dJbmRleCk7XG4gICAgICAgIGNvbnN0IHByZXZFbGVtZW50Q29sdW1uID1cbiAgICAgICAgIHRoaXMuZ3JpZC5jb2x1bW5zLmZpbmQoeCA9PiAheC5jb2x1bW5Hcm91cCAmJiB4LnZpc2libGVJbmRleCA9PT0gdmlzaWJsZUNvbHVtbkluZGV4IC0gMSAmJiAheC5oaWRkZW4pO1xuICAgICAgICAgdGhpcy5fbW92ZUZvY3VzVG9DZWxsKGN1cnJlbnRSb3dFbCwgcHJldkVsZW1lbnRDb2x1bW4sIHJvdywgc2VsZWN0ZWROb2RlLCAncHJldicpO1xuICAgICAgICBpZiAocHJldkVsZW1lbnRDb2x1bW4pIHtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhcnROYXZpZ2F0aW9uQ2VsbChwcmV2RWxlbWVudENvbHVtbi5jb2xTdGFydCwgcHJldkVsZW1lbnRDb2x1bW4ucm93U3RhcnQsIG51bGwpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBmb2N1c0NlbGxVcEZyb21MYXlvdXQocm93RWxlbWVudDogSFRNTEVsZW1lbnQsIHNlbGVjdGVkTm9kZTogSVNlbGVjdGlvbk5vZGUpIHtcbiAgICAgICAgY29uc3QgaXNOb25EYXRhUm93ID0gcm93RWxlbWVudC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICdpZ3gtZ3JpZC1ncm91cGJ5LXJvdycgfHwgdGhpcy5faXNEZXRhaWxSZWNvcmRBdChzZWxlY3RlZE5vZGUucm93KTtcbiAgICAgICAgY29uc3QgY3VycmVudFJvd1N0YXJ0ID0gc2VsZWN0ZWROb2RlLmxheW91dCA/ICBzZWxlY3RlZE5vZGUubGF5b3V0LnJvd1N0YXJ0IDogMTtcbiAgICAgICAgY29uc3QgY3VycmVudENvbFN0YXJ0ID0gdGhpcy5hcHBseU5hdmlnYXRpb25DZWxsKHNlbGVjdGVkTm9kZS5sYXlvdXQgPyBzZWxlY3RlZE5vZGUubGF5b3V0LmNvbFN0YXJ0IDogMSxcbiAgICAgICAgICAgIGN1cnJlbnRSb3dTdGFydCxcbiAgICAgICAgICAgIE5hdmlnYXRpb25EaXJlY3Rpb24udmVydGljYWwpO1xuICAgICAgICBjb25zdCBwYXJlbnRJbmRleCA9IHNlbGVjdGVkTm9kZS5jb2x1bW47XG4gICAgICAgIGNvbnN0IGNvbHVtbkxheW91dCA9IHRoaXMuZ3JpZC5jb2x1bW5zLmZpbmQoIHggPT4geC5jb2x1bW5MYXlvdXQgJiYgeC52aXNpYmxlSW5kZXggPT09IHBhcmVudEluZGV4KTtcbiAgICAgICAgbGV0IG1vdmVQcmV2O1xuICAgICAgICAvLyBjaGVjayBpZiBlbGVtZW50IHVwIGlzIGZyb20gdGhlIHNhbWUgbGF5b3V0XG4gICAgICAgIGxldCB1cHBlckVsZW1lbnRDb2x1bW4gPSBjb2x1bW5MYXlvdXQuY2hpbGRyZW4uZmluZChjID0+XG4gICAgICAgICAgICAoYy5yb3dFbmQgPT09IGN1cnJlbnRSb3dTdGFydCB8fCBjLnJvd1N0YXJ0ICsgYy5ncmlkUm93U3BhbiA9PT0gY3VycmVudFJvd1N0YXJ0KSAgJiZcbiAgICAgICAgICAgIGMuY29sU3RhcnQgPD0gY3VycmVudENvbFN0YXJ0ICYmXG4gICAgICAgICAgICAoY3VycmVudENvbFN0YXJ0IDwgYy5jb2xFbmQgfHwgY3VycmVudENvbFN0YXJ0IDwgYy5jb2xTdGFydCArIGMuZ3JpZENvbHVtblNwYW4pKTtcbiAgICAgICAgaWYgKGlzTm9uRGF0YVJvdyB8fCAhdXBwZXJFbGVtZW50Q29sdW1uKSB7XG4gICAgICAgICAgICAvLyBubyBwcmV2IHJvdyBpbiBjdXJyZW50IHJvdyBsYXlvdXQsIGdvIHRvIG5leHQgcm93IGxhc3Qgcm93c3RhcnRcbiAgICAgICAgICAgIGNvbnN0IGxheW91dFJvd0VuZCA9IHRoaXMuZ3JpZC5tdWx0aVJvd0xheW91dFJvd1NpemUgKyAxO1xuICAgICAgICAgICAgdXBwZXJFbGVtZW50Q29sdW1uID0gY29sdW1uTGF5b3V0LmNoaWxkcmVuLmZpbmQoYyA9PlxuICAgICAgICAgICAgICAgIChjLnJvd0VuZCA9PT0gbGF5b3V0Um93RW5kIHx8IGMucm93U3RhcnQgKyBjLmdyaWRSb3dTcGFuID09PSBsYXlvdXRSb3dFbmQpICYmXG4gICAgICAgICAgICAgICAgYy5jb2xTdGFydCA8PSBjdXJyZW50Q29sU3RhcnQgJiZcbiAgICAgICAgICAgICAgICAoY3VycmVudENvbFN0YXJ0IDwgYy5jb2xFbmQgfHwgY3VycmVudENvbFN0YXJ0IDwgYy5jb2xTdGFydCArIGMuZ3JpZENvbHVtblNwYW4pKTtcbiAgICAgICAgICAgIG1vdmVQcmV2ID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByb3dJbmRleCA9IG1vdmVQcmV2ID8gc2VsZWN0ZWROb2RlLnJvdyAtIDEgOiBzZWxlY3RlZE5vZGUucm93O1xuICAgICAgICBpZiAocm93SW5kZXggPCAwKSB7XG4gICAgICAgICAgICAvLyBlbmQgb2Ygcm93cyByZWFjaGVkLlxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGxldCBwcmV2Um93O1xuICAgICAgICBjb25zdCBjYiA9ICgpID0+IHtcbiAgICAgICAgICAgIHByZXZSb3cgPSB0aGlzLmdyaWQuZ2V0Um93QnlJbmRleChyb3dJbmRleCk7XG4gICAgICAgICAgICBpZiAocHJldlJvdyAmJiBwcmV2Um93LmNlbGxzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fZm9jdXNDZWxsKHVwcGVyRWxlbWVudENvbHVtbi5jZWxscy5maW5kKChjKSA9PiBjLnJvd0luZGV4ID09PSBwcmV2Um93LmluZGV4KS5uYXRpdmVFbGVtZW50KTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocHJldlJvdykge1xuICAgICAgICAgICAgICAgIHByZXZSb3cubmF0aXZlRWxlbWVudC5mb2N1cyh7IHByZXZlbnRTY3JvbGw6IHRydWUgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IHByZXZFbGVtID0gdGhpcy5nZXRSb3dCeUluZGV4KHJvd0luZGV4LCAnJykgYXMgYW55O1xuICAgICAgICAgICAgICAgIHByZXZFbGVtLmZvY3VzKHsgcHJldmVudFNjcm9sbDogdHJ1ZSB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgaWYgKHRoaXMuc2hvdWxkUGVyZm9ybVZlcnRpY2FsU2Nyb2xsKHJvd0luZGV4LCB1cHBlckVsZW1lbnRDb2x1bW4udmlzaWJsZUluZGV4KSkge1xuICAgICAgICAgICAgdGhpcy5ncmlkLm5hdGl2ZUVsZW1lbnQuZm9jdXMoeyBwcmV2ZW50U2Nyb2xsOiB0cnVlIH0pO1xuICAgICAgICAgICAgICAgIHRoaXMucGVyZm9ybVZlcnRpY2FsU2Nyb2xsVG9DZWxsKHJvd0luZGV4LCB1cHBlckVsZW1lbnRDb2x1bW4udmlzaWJsZUluZGV4LCBjYik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjYigpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBmb2N1c0NlbGxEb3duRnJvbUxheW91dChyb3dFbGVtZW50OiBIVE1MRWxlbWVudCwgc2VsZWN0ZWROb2RlOiBJU2VsZWN0aW9uTm9kZSkge1xuICAgICAgICBjb25zdCBpc05vbkRhdGFSb3cgPSByb3dFbGVtZW50LnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PT0gJ2lneC1ncmlkLWdyb3VwYnktcm93JyB8fCB0aGlzLl9pc0RldGFpbFJlY29yZEF0KHNlbGVjdGVkTm9kZS5yb3cpO1xuICAgICAgICBjb25zdCBwYXJlbnRJbmRleCA9IHNlbGVjdGVkTm9kZS5jb2x1bW47XG4gICAgICAgIGNvbnN0IGNvbHVtbkxheW91dCA9IHRoaXMuZ3JpZC5jb2x1bW5zLmZpbmQoIHggPT4geC5jb2x1bW5MYXlvdXQgJiYgeC52aXNpYmxlSW5kZXggPT09IHBhcmVudEluZGV4KTtcbiAgICAgICAgY29uc3QgY3VycmVudFJvd0VuZCA9IHNlbGVjdGVkTm9kZS5sYXlvdXQgPyBzZWxlY3RlZE5vZGUubGF5b3V0LnJvd0VuZCB8fCBzZWxlY3RlZE5vZGUubGF5b3V0LnJvd1N0YXJ0ICsgMSA6IDI7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRDb2xTdGFydCA9IHRoaXMuYXBwbHlOYXZpZ2F0aW9uQ2VsbChzZWxlY3RlZE5vZGUubGF5b3V0ID8gc2VsZWN0ZWROb2RlLmxheW91dC5jb2xTdGFydCA6IDEsXG4gICAgICAgICAgICBzZWxlY3RlZE5vZGUubGF5b3V0ID8gc2VsZWN0ZWROb2RlLmxheW91dC5yb3dTdGFydCA6IDEsXG4gICAgICAgICAgICBOYXZpZ2F0aW9uRGlyZWN0aW9uLnZlcnRpY2FsKTtcbiAgICAgICAgbGV0IG1vdmVOZXh0O1xuICAgICAgICAvLyBjaGVjayBpZiBlbGVtZW50IGRvd24gaXMgZnJvbSB0aGUgc2FtZSBsYXlvdXRcbiAgICAgICAgbGV0IG5leHRFbGVtZW50Q29sdW1uID0gY29sdW1uTGF5b3V0LmNoaWxkcmVuLmZpbmQoYyA9PiBjLnJvd1N0YXJ0ID09PSBjdXJyZW50Um93RW5kICYmXG4gICAgICAgICAgICBjLmNvbFN0YXJ0IDw9IGN1cnJlbnRDb2xTdGFydCAmJlxuICAgICAgICAgICAgKGN1cnJlbnRDb2xTdGFydCA8IGMuY29sRW5kIHx8IGN1cnJlbnRDb2xTdGFydCA8IGMuY29sU3RhcnQgKyBjLmdyaWRDb2x1bW5TcGFuKSk7XG4gICAgICAgIGlmIChpc05vbkRhdGFSb3cgfHwgIW5leHRFbGVtZW50Q29sdW1uKSB7XG4gICAgICAgICAgICAvLyBubyBuZXh0IHJvdyBpbiBjdXJyZW50IHJvdyBsYXlvdXQsIGdvIHRvIG5leHQgcm93IGZpcnN0IHJvd3N0YXJ0XG4gICAgICAgICAgICBuZXh0RWxlbWVudENvbHVtbiA9IGNvbHVtbkxheW91dC5jaGlsZHJlbi5maW5kKGMgPT4gYy5yb3dTdGFydCA9PT0gMSAmJlxuICAgICAgICAgICAgICAgIGMuY29sU3RhcnQgPD0gY3VycmVudENvbFN0YXJ0ICYmXG4gICAgICAgICAgICAgICAgKGN1cnJlbnRDb2xTdGFydCA8IGMuY29sRW5kIHx8IGN1cnJlbnRDb2xTdGFydCA8IGMuY29sU3RhcnQgKyBjLmdyaWRDb2x1bW5TcGFuKSk7XG4gICAgICAgICAgICBtb3ZlTmV4dCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgcm93SW5kZXggPSBtb3ZlTmV4dCA/IHNlbGVjdGVkTm9kZS5yb3cgKyAxIDogc2VsZWN0ZWROb2RlLnJvdztcbiAgICAgICAgaWYgKHJvd0luZGV4ID4gdGhpcy5ncmlkLmRhdGFWaWV3Lmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICAgIC8vIGVuZCBvZiByb3dzIHJlYWNoZWQuXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgbGV0IG5leHRSb3c7XG4gICAgICAgIGNvbnN0IGNiID0gKCkgPT4ge1xuICAgICAgICAgICAgbmV4dFJvdyA9IHRoaXMuZ3JpZC5nZXRSb3dCeUluZGV4KHJvd0luZGV4KTtcbiAgICAgICAgICAgIGlmIChuZXh0Um93ICYmIG5leHRSb3cuY2VsbHMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9mb2N1c0NlbGwobmV4dEVsZW1lbnRDb2x1bW4uY2VsbHMuZmluZCgoYykgPT4gYy5yb3dJbmRleCA9PT0gbmV4dFJvdy5pbmRleCkubmF0aXZlRWxlbWVudCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKG5leHRSb3cpIHtcbiAgICAgICAgICAgICAgICBuZXh0Um93Lm5hdGl2ZUVsZW1lbnQuZm9jdXMoeyBwcmV2ZW50U2Nyb2xsOiB0cnVlIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXh0RWxlbSA9IHRoaXMuZ2V0Um93QnlJbmRleChyb3dJbmRleCwgJycpIGFzIGFueTtcbiAgICAgICAgICAgICAgICBuZXh0RWxlbS5mb2N1cyh7IHByZXZlbnRTY3JvbGw6IHRydWUgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIGlmICh0aGlzLnNob3VsZFBlcmZvcm1WZXJ0aWNhbFNjcm9sbChyb3dJbmRleCwgbmV4dEVsZW1lbnRDb2x1bW4udmlzaWJsZUluZGV4KSkge1xuICAgICAgICAgICAgdGhpcy5ncmlkLm5hdGl2ZUVsZW1lbnQuZm9jdXMoeyBwcmV2ZW50U2Nyb2xsOiB0cnVlIH0pO1xuICAgICAgICAgICAgICAgIHRoaXMucGVyZm9ybVZlcnRpY2FsU2Nyb2xsVG9DZWxsKHJvd0luZGV4LCBuZXh0RWxlbWVudENvbHVtbi52aXNpYmxlSW5kZXgsIGNiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNiKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGZvY3VzTmV4dENlbGxGcm9tTGF5b3V0KGNlbGxFbGVtZW50OiBIVE1MRWxlbWVudCwgc2VsZWN0ZWROb2RlOiBJU2VsZWN0aW9uTm9kZSkge1xuICAgICAgICBjb25zdCBwYXJlbnRJbmRleCA9IHNlbGVjdGVkTm9kZS5jb2x1bW47XG4gICAgICAgIGxldCBjb2x1bW5MYXlvdXQgPSB0aGlzLmdyaWQuY29sdW1ucy5maW5kKCB4ID0+IHguY29sdW1uTGF5b3V0ICYmIHgudmlzaWJsZUluZGV4ID09PSBwYXJlbnRJbmRleCk7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRDb2xFbmQgPSBzZWxlY3RlZE5vZGUubGF5b3V0LmNvbEVuZCB8fCBzZWxlY3RlZE5vZGUubGF5b3V0LmNvbFN0YXJ0ICsgMTtcbiAgICAgICAgY29uc3QgY3VycmVudFJvd1N0YXJ0ID0gdGhpcy5hcHBseU5hdmlnYXRpb25DZWxsKHNlbGVjdGVkTm9kZS5sYXlvdXQuY29sU3RhcnQsXG4gICAgICAgICAgICBzZWxlY3RlZE5vZGUubGF5b3V0LnJvd1N0YXJ0LFxuICAgICAgICAgICAgTmF2aWdhdGlvbkRpcmVjdGlvbi5ob3Jpem9udGFsKTtcbiAgICAgICAgY29uc3Qgcm93SW5kZXggPSBzZWxlY3RlZE5vZGUucm93O1xuICAgICAgICAvLyBjaGVjayBpZiBuZXh0IGVsZW1lbnQgaXMgZnJvbSB0aGUgc2FtZSBsYXlvdXRcbiAgICAgICAgbGV0IG5leHRFbGVtZW50Q29sdW1uID0gY29sdW1uTGF5b3V0LmNoaWxkcmVuLmZpbmQoYyA9PiBjLmNvbFN0YXJ0ID09PSBjdXJyZW50Q29sRW5kICYmXG4gICAgICAgICAgICBjLnJvd1N0YXJ0IDw9IGN1cnJlbnRSb3dTdGFydCAmJlxuICAgICAgICAgICAgKGN1cnJlbnRSb3dTdGFydCA8IGMucm93RW5kIHx8IGN1cnJlbnRSb3dTdGFydCA8IGMucm93U3RhcnQgKyBjLmdyaWRSb3dTcGFuKSk7XG4gICAgICAgIGlmICghbmV4dEVsZW1lbnRDb2x1bW4pIHtcbiAgICAgICAgICAgIC8vIG5vIG5leHQgY29sdW1uIGluIGN1cnJlbnQgbGF5b3V0LCBzZWFyY2ggZm9yIG5leHQgbGF5b3V0XG4gICAgICAgICAgICBjb2x1bW5MYXlvdXQgPSB0aGlzLmdyaWQuY29sdW1ucy5maW5kKGMgPT4gYy5jb2x1bW5MYXlvdXQgJiYgIWMuaGlkZGVuICYmIGMudmlzaWJsZUluZGV4ID09PSBjb2x1bW5MYXlvdXQudmlzaWJsZUluZGV4ICsgMSk7XG4gICAgICAgICAgICBpZiAoIWNvbHVtbkxheW91dCkge1xuICAgICAgICAgICAgICAgIC8vIHJlYWNoZWQgdGhlIGVuZFxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gbmV4dCBlbGVtZW50IGlzIGZyb20gdGhlIG5leHQgbGF5b3V0XG4gICAgICAgICAgICBuZXh0RWxlbWVudENvbHVtbiA9IGNvbHVtbkxheW91dC5jaGlsZHJlbi5maW5kKGMgPT4gYy5jb2xTdGFydCA9PT0gMSAmJlxuICAgICAgICAgICAgICAgIGMucm93U3RhcnQgPD0gY3VycmVudFJvd1N0YXJ0ICYmXG4gICAgICAgICAgICAgICAgKGN1cnJlbnRSb3dTdGFydCA8IGMucm93RW5kIHx8IGN1cnJlbnRSb3dTdGFydCA8IGMucm93U3RhcnQgKyBjLmdyaWRSb3dTcGFuKSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2IgPSAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBuZXh0RWxlbWVudCA9IG5leHRFbGVtZW50Q29sdW1uLmNlbGxzLmZpbmQoKGMpID0+IGMucm93SW5kZXggPT09IHJvd0luZGV4KS5uYXRpdmVFbGVtZW50O1xuICAgICAgICAgICB0aGlzLl9mb2N1c0NlbGwobmV4dEVsZW1lbnQpO1xuICAgICAgICB9O1xuICAgICAgICBpZiAoIXRoaXMuaXNDb2x1bW5SaWdodEVkZ2VWaXNpYmxlKG5leHRFbGVtZW50Q29sdW1uLnZpc2libGVJbmRleCkpIHtcbiAgICAgICAgICAgIHRoaXMuZ3JpZC5uYXRpdmVFbGVtZW50LmZvY3VzKHsgcHJldmVudFNjcm9sbDogdHJ1ZSB9KTtcbiAgICAgICAgICAgIHRoaXMucGVyZm9ybUhvcml6b250YWxTY3JvbGxUb0NlbGwocm93SW5kZXgsIG5leHRFbGVtZW50Q29sdW1uLnZpc2libGVJbmRleCwgZmFsc2UsIGNiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNiKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGZvY3VzUHJldkNlbGxGcm9tTGF5b3V0KGNlbGxFbGVtZW50OiBIVE1MRWxlbWVudCwgc2VsZWN0ZWROb2RlOiBJU2VsZWN0aW9uTm9kZSkge1xuICAgICAgICBjb25zdCBwYXJlbnRJbmRleCA9IHNlbGVjdGVkTm9kZS5jb2x1bW47XG4gICAgICAgIGxldCBjb2x1bW5MYXlvdXQgPSB0aGlzLmdyaWQuY29sdW1ucy5maW5kKCB4ID0+IHguY29sdW1uTGF5b3V0ICYmIHgudmlzaWJsZUluZGV4ID09PSBwYXJlbnRJbmRleCk7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRDb2xTdGFydCA9IHNlbGVjdGVkTm9kZS5sYXlvdXQuY29sU3RhcnQ7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRSb3dTdGFydCA9IHRoaXMuYXBwbHlOYXZpZ2F0aW9uQ2VsbChjdXJyZW50Q29sU3RhcnQsXG4gICAgICAgICAgICBzZWxlY3RlZE5vZGUubGF5b3V0LnJvd1N0YXJ0LFxuICAgICAgICAgICAgTmF2aWdhdGlvbkRpcmVjdGlvbi5ob3Jpem9udGFsKTtcbiAgICAgICAgY29uc3Qgcm93SW5kZXggPSBzZWxlY3RlZE5vZGUucm93O1xuXG4gICAgICAgIC8vIGNoZWNrIHByZXZpb3VzIGVsZW1lbnQgaXMgZnJvbSB0aGUgc2FtZSBsYXlvdXRcbiAgICAgICAgbGV0IHByZXZFbGVtZW50Q29sdW1uID0gY29sdW1uTGF5b3V0LmNoaWxkcmVuXG4gICAgICAgIC5maW5kKGMgPT4gKGMuY29sRW5kID09PSBjdXJyZW50Q29sU3RhcnQgfHwgYy5jb2xTdGFydCArIGMuZ3JpZENvbHVtblNwYW4gPT09IGN1cnJlbnRDb2xTdGFydCApICYmXG4gICAgICAgICAgICBjLnJvd1N0YXJ0IDw9IGN1cnJlbnRSb3dTdGFydCAmJlxuICAgICAgICAgICAgKGN1cnJlbnRSb3dTdGFydCA8IGMucm93RW5kIHx8IGN1cnJlbnRSb3dTdGFydCA8IGMucm93U3RhcnQgKyBjLmdyaWRSb3dTcGFuKSk7XG4gICAgICAgIGlmICghcHJldkVsZW1lbnRDb2x1bW4pIHtcbiAgICAgICAgICAgIC8vIG5vIHByZXYgY29sdW1uIGluIGN1cnJlbnQgbGF5b3V0LCBzZWFjcmggZm9yIHByZXYgbGF5b3V0XG4gICAgICAgICAgICBjb2x1bW5MYXlvdXQgPSB0aGlzLmdyaWQuY29sdW1ucy5maW5kKGMgPT4gYy5jb2x1bW5MYXlvdXQgJiYgIWMuaGlkZGVuICYmIGMudmlzaWJsZUluZGV4ID09PSBjb2x1bW5MYXlvdXQudmlzaWJsZUluZGV4IC0gMSk7XG4gICAgICAgICAgICBpZiAoIWNvbHVtbkxheW91dCkge1xuICAgICAgICAgICAgICAgIC8vIHJlYWNoZWQgdGhlIGVuZFxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgbGF5b3V0U2l6ZSA9IGNvbHVtbkxheW91dC5nZXRJbml0aWFsQ2hpbGRDb2x1bW5TaXplcyhjb2x1bW5MYXlvdXQuY2hpbGRyZW4pLmxlbmd0aDtcbiAgICAgICAgICAgIC8vIGZpcnN0IGVsZW1lbnQgaXMgZnJvbSB0aGUgbmV4dCBsYXlvdXRcbiAgICAgICAgICAgIHByZXZFbGVtZW50Q29sdW1uID0gY29sdW1uTGF5b3V0LmNoaWxkcmVuXG4gICAgICAgICAgICAuZmluZChjID0+IChjLmNvbEVuZCA9PT0gbGF5b3V0U2l6ZSArIDEgfHwgYy5jb2xTdGFydCArIGMuZ3JpZENvbHVtblNwYW4gPT09IGxheW91dFNpemUgKyAxKSAmJlxuICAgICAgICAgICAgICAgIGMucm93U3RhcnQgPD0gY3VycmVudFJvd1N0YXJ0ICYmXG4gICAgICAgICAgICAgICAgKGN1cnJlbnRSb3dTdGFydCA8IGMucm93RW5kIHx8IGN1cnJlbnRSb3dTdGFydCA8IGMucm93U3RhcnQgKyBjLmdyaWRSb3dTcGFuKSk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBjYiA9ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHByZXZFbGVtZW50ID0gcHJldkVsZW1lbnRDb2x1bW4uY2VsbHMuZmluZCgoYykgPT4gYy5yb3dJbmRleCA9PT0gcm93SW5kZXgpLm5hdGl2ZUVsZW1lbnQ7XG4gICAgICAgICAgICB0aGlzLl9mb2N1c0NlbGwocHJldkVsZW1lbnQpO1xuICAgICAgICB9O1xuICAgICAgICBpZiAoIXRoaXMuaXNDb2x1bW5MZWZ0RWRnZVZpc2libGUocHJldkVsZW1lbnRDb2x1bW4udmlzaWJsZUluZGV4KSkge1xuICAgICAgICAgICAgdGhpcy5ncmlkLm5hdGl2ZUVsZW1lbnQuZm9jdXMoeyBwcmV2ZW50U2Nyb2xsOiB0cnVlIH0pO1xuICAgICAgICAgICAgdGhpcy5wZXJmb3JtSG9yaXpvbnRhbFNjcm9sbFRvQ2VsbChyb3dJbmRleCwgcHJldkVsZW1lbnRDb2x1bW4udmlzaWJsZUluZGV4LCBmYWxzZSwgY2IpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY2IoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBvbktleWRvd25FbmQocm93SW5kZXg6IG51bWJlciwgaXNTdW1tYXJ5OiBib29sZWFuID0gZmFsc2UsIGNlbGxSb3dTdGFydD86IG51bWJlcikge1xuICAgICAgICBjb25zdCBsYXlvdXRzID0gdGhpcy5ncmlkLmNvbHVtbnMuZmlsdGVyKGMgPT4gYy5jb2x1bW5MYXlvdXQgJiYgIWMuaGlkZGVuKS5zb3J0KChhLCBiKSA9PiBhLnZpc2libGVJbmRleCAtIGIudmlzaWJsZUluZGV4KTtcbiAgICAgICAgY29uc3QgbGFzdExheW91dCA9IGxheW91dHNbbGF5b3V0cy5sZW5ndGggLSAxXTtcbiAgICAgICAgY29uc3QgbGFzdExheW91dENoaWxkcmVuID0gbGFzdExheW91dC5jaGlsZHJlbjtcbiAgICAgICAgY29uc3QgbGF5b3V0U2l6ZSA9ICBsYXN0TGF5b3V0LmdldEluaXRpYWxDaGlsZENvbHVtblNpemVzKGxhc3RMYXlvdXRDaGlsZHJlbikubGVuZ3RoO1xuICAgICAgICBjb25zdCBjdXJyZW50Um93U3RhcnQgPSB0aGlzLmFwcGx5TmF2aWdhdGlvbkNlbGwoXG4gICAgICAgICAgICB0aGlzLnN0YXJ0TmF2aWdhdGlvbkNlbGwgPyB0aGlzLnN0YXJ0TmF2aWdhdGlvbkNlbGwuY29sU3RhcnQgOiAxLFxuICAgICAgICAgICAgY2VsbFJvd1N0YXJ0IHx8IHRoaXMuZ3JpZC5tdWx0aVJvd0xheW91dFJvd1NpemUsXG4gICAgICAgICAgICBOYXZpZ2F0aW9uRGlyZWN0aW9uLmhvcml6b250YWwpO1xuICAgICAgICBjb25zdCBuZXh0RWxlbWVudENvbHVtbiA9IGxhc3RMYXlvdXQuY2hpbGRyZW4uZmluZChjID0+XG4gICAgICAgICAgICAoYy5jb2xFbmQgPT09IGxheW91dFNpemUgKyAxIHx8IGMuY29sU3RhcnQgKyBjLmdyaWRDb2x1bW5TcGFuID09PSBsYXlvdXRTaXplICsgMSkgJiZcbiAgICAgICAgICAgIGMucm93U3RhcnQgPD0gY3VycmVudFJvd1N0YXJ0ICYmXG4gICAgICAgICAgICAoY3VycmVudFJvd1N0YXJ0IDwgYy5yb3dFbmQgfHwgY3VycmVudFJvd1N0YXJ0IDwgYy5yb3dTdGFydCArIGMuZ3JpZFJvd1NwYW4pKTtcbiAgICAgICAgY29uc3QgaW5kZXhJbkxheW91dCA9IGxhc3RMYXlvdXRDaGlsZHJlbi50b0FycmF5KCkuaW5kZXhPZihuZXh0RWxlbWVudENvbHVtbik7XG5cbiAgICAgICAgY29uc3Qgcm93TGlzdCA9IGlzU3VtbWFyeSA/IHRoaXMuZ3JpZC5zdW1tYXJpZXNSb3dMaXN0IDogdGhpcy5ncmlkLmRhdGFSb3dMaXN0O1xuICAgICAgICBsZXQgcm93RWxlbWVudCA9IHJvd0xpc3QuZmluZCgocm93KSA9PiByb3cuaW5kZXggPT09IHJvd0luZGV4KTtcbiAgICAgICAgaWYgKCFyb3dFbGVtZW50KSB7IHJldHVybjsgfVxuICAgICAgICByb3dFbGVtZW50ID0gcm93RWxlbWVudC5uYXRpdmVFbGVtZW50O1xuXG4gICAgICAgIGlmICghdGhpcy5pc0NvbHVtblJpZ2h0RWRnZVZpc2libGUobmV4dEVsZW1lbnRDb2x1bW4udmlzaWJsZUluZGV4KSkge1xuICAgICAgICAgICAgdGhpcy5ncmlkLm5hdGl2ZUVsZW1lbnQuZm9jdXMoeyBwcmV2ZW50U2Nyb2xsOiB0cnVlIH0pO1xuICAgICAgICAgICAgY29uc3QgY2IgPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgYWxsQmxvY2tzID0gcm93RWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuZ2V0Q29sdW1uTGF5b3V0U2VsZWN0b3IoKSk7XG4gICAgICAgICAgICAgICAgY29uc3QgY2VsbCA9IGFsbEJsb2Nrc1thbGxCbG9ja3MubGVuZ3RoIC0gMV0uY2hpbGRyZW5baW5kZXhJbkxheW91dF07XG4gICAgICAgICAgICAgICAgdGhpcy5fZm9jdXNDZWxsKGNlbGwpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRoaXMucGVyZm9ybUhvcml6b250YWxTY3JvbGxUb0NlbGwocm93SW5kZXgsIG5leHRFbGVtZW50Q29sdW1uLnZpc2libGVJbmRleCwgZmFsc2UsIGNiKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IGFsbEJsb2NrcyA9IHJvd0VsZW1lbnQucXVlcnlTZWxlY3RvckFsbCh0aGlzLmdldENvbHVtbkxheW91dFNlbGVjdG9yKCkpO1xuICAgICAgICAgICAgY29uc3QgY2VsbCA9ICBhbGxCbG9ja3NbYWxsQmxvY2tzLmxlbmd0aCAtIDFdLmNoaWxkcmVuW2luZGV4SW5MYXlvdXRdO1xuICAgICAgICAgICAgdGhpcy5fZm9jdXNDZWxsKGNlbGwpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIG9uS2V5ZG93bkhvbWUocm93SW5kZXg6IG51bWJlciwgaXNTdW1tYXJ5OiBib29sZWFuID0gZmFsc2UsIGNlbGxSb3dTdGFydDogbnVtYmVyID0gMSkge1xuICAgICAgICBjb25zdCBmaXJzdExheW91dCA9IHRoaXMuZ3JpZC5jb2x1bW5zLmZpbHRlcihjID0+IGMuY29sdW1uTGF5b3V0ICYmICFjLmhpZGRlbilbMF07XG4gICAgICAgIGNvbnN0IGxhc3RMYXlvdXRDaGlsZHJlbiA9IGZpcnN0TGF5b3V0LmNoaWxkcmVuLnRvQXJyYXkoKTtcbiAgICAgICAgY29uc3QgY3VycmVudFJvd1N0YXJ0ID0gdGhpcy5hcHBseU5hdmlnYXRpb25DZWxsKFxuICAgICAgICAgICAgdGhpcy5zdGFydE5hdmlnYXRpb25DZWxsID8gdGhpcy5zdGFydE5hdmlnYXRpb25DZWxsLmNvbFN0YXJ0IDogMSxcbiAgICAgICAgICAgIGNlbGxSb3dTdGFydCxcbiAgICAgICAgICAgIE5hdmlnYXRpb25EaXJlY3Rpb24uaG9yaXpvbnRhbCk7XG4gICAgICAgIGNvbnN0IG5leHRFbGVtZW50Q29sdW1uID0gZmlyc3RMYXlvdXQuY2hpbGRyZW4uZmluZChjID0+XG4gICAgICAgICAgICBjLmNvbFN0YXJ0ID09PSAxICYmXG4gICAgICAgICAgICBjLnJvd1N0YXJ0IDw9IGN1cnJlbnRSb3dTdGFydCAmJlxuICAgICAgICAgICAgKGN1cnJlbnRSb3dTdGFydCA8IGMucm93RW5kIHx8IGN1cnJlbnRSb3dTdGFydCA8IGMucm93U3RhcnQgKyBjLmdyaWRSb3dTcGFuKSk7XG4gICAgICAgIGNvbnN0IGluZGV4SW5MYXlvdXQgPSBsYXN0TGF5b3V0Q2hpbGRyZW4uaW5kZXhPZihuZXh0RWxlbWVudENvbHVtbik7XG5cbiAgICAgICAgY29uc3Qgcm93TGlzdCA9IGlzU3VtbWFyeSA/IHRoaXMuZ3JpZC5zdW1tYXJpZXNSb3dMaXN0IDogdGhpcy5ncmlkLmRhdGFSb3dMaXN0O1xuICAgICAgICBsZXQgcm93RWxlbWVudCA9IHJvd0xpc3QuZmluZCgocm93KSA9PiByb3cuaW5kZXggPT09IHJvd0luZGV4KTtcbiAgICAgICAgaWYgKCFyb3dFbGVtZW50KSB7IHJldHVybjsgfVxuICAgICAgICByb3dFbGVtZW50ID0gcm93RWxlbWVudC5uYXRpdmVFbGVtZW50O1xuXG4gICAgICAgIGlmICghdGhpcy5pc0NvbHVtbkxlZnRFZGdlVmlzaWJsZShuZXh0RWxlbWVudENvbHVtbi52aXNpYmxlSW5kZXgpKSB7XG4gICAgICAgICAgICB0aGlzLmdyaWQubmF0aXZlRWxlbWVudC5mb2N1cyh7IHByZXZlbnRTY3JvbGw6IHRydWUgfSk7XG4gICAgICAgICAgIGNvbnN0IGNiID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGFsbEJsb2NrcyA9IHJvd0VsZW1lbnQucXVlcnlTZWxlY3RvckFsbCh0aGlzLmdldENvbHVtbkxheW91dFNlbGVjdG9yKCkpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGNlbGwgPSBhbGxCbG9ja3NbMF0uY2hpbGRyZW5baW5kZXhJbkxheW91dF07XG4gICAgICAgICAgICAgICAgdGhpcy5fZm9jdXNDZWxsKGNlbGwpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRoaXMucGVyZm9ybUhvcml6b250YWxTY3JvbGxUb0NlbGwocm93SW5kZXgsIG5leHRFbGVtZW50Q29sdW1uLnZpc2libGVJbmRleCwgZmFsc2UsIGNiKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IGFsbEJsb2NrcyA9IHJvd0VsZW1lbnQucXVlcnlTZWxlY3RvckFsbCh0aGlzLmdldENvbHVtbkxheW91dFNlbGVjdG9yKCkpO1xuICAgICAgICAgICAgY29uc3QgY2VsbCA9ICBhbGxCbG9ja3NbMF0uY2hpbGRyZW5baW5kZXhJbkxheW91dF07XG4gICAgICAgICAgICB0aGlzLl9mb2N1c0NlbGwoY2VsbCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgZ2V0Q29sdW1uTGF5b3V0U2VsZWN0b3IoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuICcuaWd4LWdyaWRfX21ybC1ibG9jayc7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGdldENoaWxkQ29sdW1uU2Nyb2xsUG9zaXRpb25zKHZpc2libGVDb2xJbmRleDogbnVtYmVyKTogeyBsZWZ0U2Nyb2xsOiBudW1iZXIsIHJpZ2h0U2Nyb2xsOiBudW1iZXIgfSB7XG4gICAgICAgIGNvbnN0IGZvck9mRGlyID0gdGhpcy5ncmlkLmRhdGFSb3dMaXN0Lmxlbmd0aCA+IDAgPyB0aGlzLmdyaWQuZGF0YVJvd0xpc3QuZmlyc3QudmlydERpclJvdyA6IHRoaXMuZ3JpZC5oZWFkZXJDb250YWluZXI7XG4gICAgICAgIGNvbnN0IHRhcmdldENvbDogSWd4Q29sdW1uQ29tcG9uZW50ID0gdGhpcy5nZXRDb2x1bm1CeVZpc2libGVJbmRleCh2aXNpYmxlQ29sSW5kZXgpO1xuICAgICAgICBjb25zdCBwYXJlbnQgPSB0YXJnZXRDb2wucGFyZW50O1xuICAgICAgICBjb25zdCBwYXJlbnRWSW5kZXggPSBmb3JPZkRpci5pZ3hGb3JPZi5pbmRleE9mKHBhcmVudCk7XG4gICAgICAgIGxldCBsZWZ0U2Nyb2xsID0gZm9yT2ZEaXIuZ2V0Q29sdW1uU2Nyb2xsTGVmdChwYXJlbnRWSW5kZXgpLCByaWdodFNjcm9sbCA9IDA7XG4gICAgICAgIC8vIGNhY3VsYXRlIG9mZnNldCBmcm9tIHBhcmVudCBiYXNlZCBvbiB0YXJnZXQgY29sdW1uIGNvbFN0YXJ0IGFuZCBjb2xFbmQgYW5kIHRoZSByZXNvbHZlZCBjaGlsZCBjb2x1bW4gc2l6ZXMuXG4gICAgICAgIGNvbnN0IGNoaWxkU2l6ZXMgPSBwYXJlbnQuZ2V0RmlsbGVkQ2hpbGRDb2x1bW5TaXplcyhwYXJlbnQuY2hpbGRyZW4pO1xuICAgICAgICBjb25zdCBjb2xTdGFydCA9IHRhcmdldENvbC5jb2xTdGFydCB8fCAxO1xuICAgICAgICBjb25zdCBjb2xFbmQgPSB0YXJnZXRDb2wuY29sRW5kIHx8IGNvbFN0YXJ0ICsgMTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBjb2xTdGFydDsgaSsrKSB7XG4gICAgICAgICAgICBsZWZ0U2Nyb2xsICs9IHBhcnNlSW50KGNoaWxkU2l6ZXNbaSAtIDFdLCAxMCk7XG4gICAgICAgIH1cbiAgICAgICAgcmlnaHRTY3JvbGwgKz0gbGVmdFNjcm9sbDtcbiAgICAgICAgZm9yIChsZXQgaiA9IGNvbFN0YXJ0OyBqIDwgY29sRW5kOyBqKyspIHtcbiAgICAgICAgICAgIHJpZ2h0U2Nyb2xsICs9ICBwYXJzZUludChjaGlsZFNpemVzW2ogLSAxXSwgMTApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7bGVmdFNjcm9sbCwgcmlnaHRTY3JvbGx9O1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBnZXRDb2x1bm1CeVZpc2libGVJbmRleCh2aXNpYmxlQ29sSW5kZXg6IG51bWJlcik6IElneENvbHVtbkNvbXBvbmVudCB7XG4gICAgICAgIHZpc2libGVDb2xJbmRleCA9IHZpc2libGVDb2xJbmRleCA8IDAgPyAwIDogdmlzaWJsZUNvbEluZGV4O1xuICAgICAgICByZXR1cm4gdGhpcy5ncmlkLmNvbHVtbkxpc3QuZmluZCgoY29sKSA9PiAhY29sLmNvbHVtbkxheW91dCAmJiBjb2wudmlzaWJsZUluZGV4ID09PSB2aXNpYmxlQ29sSW5kZXgpO1xuICAgIH1cblxuICAgIHB1YmxpYyBzaG91bGRQZXJmb3JtVmVydGljYWxTY3JvbGwocm93SW5kZXg6IG51bWJlciwgdmlzaWJsZUNvbHVtbkluZGV4OiBudW1iZXIpOiBib29sZWFuIHtcbiAgICAgICAgaWYgKHRoaXMuX2lzR3JvdXBSZWNvcmRBdChyb3dJbmRleCkgfHwgdGhpcy5faXNEZXRhaWxSZWNvcmRBdChyb3dJbmRleCkpIHtcbiAgICAgICAgICAgIHJldHVybiBzdXBlci5zaG91bGRQZXJmb3JtVmVydGljYWxTY3JvbGwocm93SW5kZXgsIHZpc2libGVDb2x1bW5JbmRleCk7XG4gICAgICAgfVxuICAgICAgICBpZiAoIXN1cGVyLnNob3VsZFBlcmZvcm1WZXJ0aWNhbFNjcm9sbChyb3dJbmRleCwgdmlzaWJsZUNvbHVtbkluZGV4KSkge3JldHVybiBmYWxzZTsgfVxuICAgICAgIGNvbnN0IHRhcmdldFJvdyA9IHRoaXMuZ3JpZC5zdW1tYXJpZXNSb3dMaXN0LmZpbHRlcihzID0+IHMuaW5kZXggIT09IDApXG4gICAgICAgICAgIC5jb25jYXQodGhpcy5ncmlkLnJvd0xpc3QudG9BcnJheSgpKS5maW5kKHIgPT4gci5pbmRleCA9PT0gcm93SW5kZXgpO1xuICAgICAgIGNvbnN0IHNjcm9sbFRvcCA9ICBNYXRoLmFicyh0aGlzLmdyaWQudmVydGljYWxTY3JvbGxDb250YWluZXIuZ2V0U2Nyb2xsKCkuc2Nyb2xsVG9wKTtcbiAgICAgICBjb25zdCBjb250YWluZXJIZWlnaHQgPSB0aGlzLmdyaWQuY2FsY0hlaWdodCA/IE1hdGguY2VpbCh0aGlzLmdyaWQuY2FsY0hlaWdodCkgOiAwO1xuICAgICAgIGNvbnN0IHNjcm9sbFBvcyA9IHRoaXMuZ2V0VmVydGljYWxTY3JvbGxQb3NpdGlvbnMocm93SW5kZXgsIHZpc2libGVDb2x1bW5JbmRleCk7XG4gICAgICAgaWYgKCF0YXJnZXRSb3cgfHwgdGFyZ2V0Um93Lm5hdGl2ZUVsZW1lbnQub2Zmc2V0VG9wICsgc2Nyb2xsUG9zLnRvcE9mZnNldCA8IE1hdGguYWJzKHRoaXMudmVydGljYWxEQ1RvcE9mZnNldClcbiAgICAgICAgICAgfHwgY29udGFpbmVySGVpZ2h0ICYmIGNvbnRhaW5lckhlaWdodCA8IHNjcm9sbFBvcy5yb3dCb3R0b20gLSBzY3JvbGxUb3ApIHtcbiAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgIH1cbiAgIH1cblxuICAgZ2V0IHZlcnRpY2FsRENUb3BPZmZzZXQoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHBhcnNlSW50KHRoaXMuZ3JpZC52ZXJ0aWNhbFNjcm9sbENvbnRhaW5lci5kYy5pbnN0YW5jZS5fdmlld0NvbnRhaW5lci5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQuc3R5bGUudG9wLCAxMCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfaXNHcm91cFJlY29yZEF0KHJvd0luZGV4OiBudW1iZXIpIHtcbiAgICAgICAgY29uc3QgcmVjb3JkID0gdGhpcy5ncmlkLmRhdGFWaWV3W3Jvd0luZGV4XTtcbiAgICAgICAgcmV0dXJuIHJlY29yZC5yZWNvcmRzICYmIHJlY29yZC5yZWNvcmRzLmxlbmd0aDtcbiAgICB9XG4gICAgcHJpdmF0ZSBfaXNEZXRhaWxSZWNvcmRBdChyb3dJbmRleDogbnVtYmVyKSB7XG4gICAgICAgIGNvbnN0IHJlY29yZCA9IHRoaXMuZ3JpZC5kYXRhVmlld1tyb3dJbmRleF07XG4gICAgICAgIHJldHVybiB0aGlzLmdyaWQuaXNEZXRhaWxSZWNvcmQocmVjb3JkKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgcGVyZm9ybVZlcnRpY2FsU2Nyb2xsVG9DZWxsKHJvd0luZGV4OiBudW1iZXIsIHZpc2libGVDb2x1bW5JbmRleDogbnVtYmVyLCBjYj86ICgpID0+IHZvaWQpIHtcbiAgICAgICAgaWYgKHRoaXMuX2lzR3JvdXBSZWNvcmRBdChyb3dJbmRleCkgfHwgdGhpcy5faXNEZXRhaWxSZWNvcmRBdChyb3dJbmRleCkpIHtcbiAgICAgICAgICAgIHJldHVybiBzdXBlci5wZXJmb3JtVmVydGljYWxTY3JvbGxUb0NlbGwocm93SW5kZXgsIHZpc2libGVDb2x1bW5JbmRleCwgY2IpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNvbnRhaW5lckhlaWdodCA9IHRoaXMuZ3JpZC5jYWxjSGVpZ2h0ID8gTWF0aC5jZWlsKHRoaXMuZ3JpZC5jYWxjSGVpZ2h0KSA6IDA7XG4gICAgICAgIGNvbnN0IHNjcm9sbFRvcCA9IE1hdGguYWJzKHRoaXMuZ3JpZC52ZXJ0aWNhbFNjcm9sbENvbnRhaW5lci5nZXRTY3JvbGwoKS5zY3JvbGxUb3ApO1xuICAgICAgICBjb25zdCBzY3JvbGxQb3MgPSB0aGlzLmdldFZlcnRpY2FsU2Nyb2xsUG9zaXRpb25zKHJvd0luZGV4LCB2aXNpYmxlQ29sdW1uSW5kZXgpO1xuICAgICAgICBjb25zdCB0YXJnZXRSb3cgPSB0aGlzLmdyaWQuc3VtbWFyaWVzUm93TGlzdC5maWx0ZXIocyA9PiBzLmluZGV4ICE9PSAwKVxuICAgICAgICAgICAgLmNvbmNhdCh0aGlzLmdyaWQucm93TGlzdC50b0FycmF5KCkpLmZpbmQociA9PiByLmluZGV4ID09PSByb3dJbmRleCk7XG4gICAgICAgIGNvbnN0IGlzUHJldmlvdXMgPSAgKHNjcm9sbFRvcCA+IHNjcm9sbFBvcy5yb3dUb3ApICYmICghdGFyZ2V0Um93IHx8XG4gICAgICAgICAgICAgICAgdGFyZ2V0Um93Lm5hdGl2ZUVsZW1lbnQub2Zmc2V0VG9wICsgc2Nyb2xsUG9zLnRvcE9mZnNldCA8IE1hdGguYWJzKHRoaXMudmVydGljYWxEQ1RvcE9mZnNldCkpO1xuICAgICAgICBjb25zdCBzY3JvbGxBbW91bnQgPSBpc1ByZXZpb3VzID8gc2Nyb2xsUG9zLnJvd1RvcCA6IE1hdGguYWJzKHNjcm9sbFRvcCArIGNvbnRhaW5lckhlaWdodCAtIHNjcm9sbFBvcy5yb3dCb3R0b20pO1xuXG4gICAgICAgIHRoaXMuZ3JpZC52ZXJ0aWNhbFNjcm9sbENvbnRhaW5lci5vbkNodW5rTG9hZFxuICAgICAgICAucGlwZShmaXJzdCgpKS5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgICAgY2IoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKGlzUHJldmlvdXMpIHtcbiAgICAgICAgICAgIHRoaXMuZ3JpZC52ZXJ0aWNhbFNjcm9sbENvbnRhaW5lci5zY3JvbGxQb3NpdGlvbiA9IHNjcm9sbEFtb3VudDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuZ3JpZC52ZXJ0aWNhbFNjcm9sbENvbnRhaW5lci5hZGRTY3JvbGxUb3Aoc2Nyb2xsQW1vdW50KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBnZXRWZXJ0aWNhbFNjcm9sbFBvc2l0aW9ucyhyb3dJbmRleDogbnVtYmVyLCB2aXNpYmxlQ29sSW5kZXg6IG51bWJlcik6IHsgcm93VG9wOiBudW1iZXIsIHJvd0JvdHRvbTogbnVtYmVyLCB0b3BPZmZzZXQ6IG51bWJlciB9IHtcbiAgICAgICAgY29uc3QgdGFyZ2V0Q29sOiBJZ3hDb2x1bW5Db21wb25lbnQgPSB0aGlzLmdldENvbHVubUJ5VmlzaWJsZUluZGV4KHZpc2libGVDb2xJbmRleCk7XG4gICAgICAgIGNvbnN0IHRvcE9mZnNldCA9ICh0YXJnZXRDb2wucm93U3RhcnQgLSAxKSAgKiB0aGlzLmdyaWQuZGVmYXVsdFJvd0hlaWdodDtcbiAgICAgICAgY29uc3Qgcm93VG9wID0gdGhpcy5ncmlkLnZlcnRpY2FsU2Nyb2xsQ29udGFpbmVyLnNpemVzQ2FjaGVbcm93SW5kZXhdICsgdG9wT2Zmc2V0O1xuICAgICAgICBjb25zdCByb3dCb3R0b20gPSByb3dUb3AgKyAodGhpcy5ncmlkLmRlZmF1bHRSb3dIZWlnaHQgKiB0YXJnZXRDb2wuZ3JpZFJvd1NwYW4pO1xuICAgICAgICByZXR1cm4geyByb3dUb3AsIHJvd0JvdHRvbSwgdG9wT2Zmc2V0IH07XG4gICAgfVxuXG4gICAgcHVibGljIHBlcmZvcm1Ib3Jpem9udGFsU2Nyb2xsVG9DZWxsKFxuICAgICAgICByb3dJbmRleDogbnVtYmVyLCB2aXNpYmxlQ29sdW1uSW5kZXg6IG51bWJlciwgaXNTdW1tYXJ5OiBib29sZWFuID0gZmFsc2UsIGNiPzogKCkgPT4gdm9pZCkge1xuICAgICAgICBjb25zdCBzY3JvbGxQb3MgPSB0aGlzLmdldENoaWxkQ29sdW1uU2Nyb2xsUG9zaXRpb25zKHZpc2libGVDb2x1bW5JbmRleCk7XG4gICAgICAgIGNvbnN0IGhTY3JvbGwgPSB0aGlzLmhvcml6b250YWxTY3JvbGwocm93SW5kZXgpO1xuICAgICAgICB0aGlzLmdyaWQucGFyZW50VmlydERpci5vbkNodW5rTG9hZFxuICAgICAgICAgICAgLnBpcGUoZmlyc3QoKSlcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChjYikge1xuICAgICAgICAgICAgICAgICAgICBjYigpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2ZvY3VzQ2VsbCh0aGlzLmdldENlbGxFbGVtZW50QnlWaXNpYmxlSW5kZXgocm93SW5kZXgsIHZpc2libGVDb2x1bW5JbmRleCwgaXNTdW1tYXJ5KSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgaXNQcmV2SXRlbSA9ICBoU2Nyb2xsLmdldFNjcm9sbCgpLnNjcm9sbExlZnQgPiBzY3JvbGxQb3MubGVmdFNjcm9sbDtcbiAgICAgICAgY29uc3QgY29udGFpbmVyU2l6ZSA9IHBhcnNlSW50KGhTY3JvbGwuaWd4Rm9yQ29udGFpbmVyU2l6ZSwgMTApO1xuICAgICAgICBjb25zdCBuZXh0U2Nyb2xsID0gaXNQcmV2SXRlbSA/IHNjcm9sbFBvcy5sZWZ0U2Nyb2xsIDogc2Nyb2xsUG9zLnJpZ2h0U2Nyb2xsIC0gY29udGFpbmVyU2l6ZTtcbiAgICAgICAgaFNjcm9sbC5zY3JvbGxQb3NpdGlvbiA9IG5leHRTY3JvbGw7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIF9mb2N1c0NlbGwoY2VsbEVsZW06IEhUTUxFbGVtZW50KSB7XG4gICAgICAgIC8vIGluIGNhc2Ugb2YgdmFyaWFibGUgcm93IGhlaWdodHMgaW4gbXJsIGdyaWQgbWFrZSBzdXJlIGNlbGwgaXMgcmVhbGx5IGluIHZpZXcgYWZ0ZXIgaXQgaGFzIGJlZW4gcmVuZGVyZWQuXG4gICAgICAgIGNvbnN0IGdyaWRCb3VuZGluZ0NsaWVudFJlY3QgPSB0aGlzLmdyaWQudGJvZHkubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgY29uc3QgZGlmZlRvcCA9IGNlbGxFbGVtLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcCAtIGdyaWRCb3VuZGluZ0NsaWVudFJlY3QudG9wO1xuICAgICAgICBjb25zdCBkaWZmQm90dG9tID0gY2VsbEVsZW0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkuYm90dG9tIC0gZ3JpZEJvdW5kaW5nQ2xpZW50UmVjdC5ib3R0b207XG5cbiAgICAgICAgaWYgKGRpZmZUb3AgPCAwKSB7XG4gICAgICAgICAgICAvLyBjZWxsIGlzIGFib3ZlIGdyaWQgdG9wIC0gbm90IHZpc2libGVcbiAgICAgICAgICAgIHRoaXMuZ3JpZC5uYXRpdmVFbGVtZW50LmZvY3VzKHsgcHJldmVudFNjcm9sbDogdHJ1ZSB9KTtcbiAgICAgICAgICAgIHRoaXMuZ3JpZC52ZXJ0aWNhbFNjcm9sbENvbnRhaW5lci5vbkNodW5rTG9hZFxuICAgICAgICAgICAgICAgIC5waXBlKGZpcnN0KCkpXG4gICAgICAgICAgICAgICAgLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNlbGxFbGVtLmZvY3VzKHsgcHJldmVudFNjcm9sbDogdHJ1ZSB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5ncmlkLnZlcnRpY2FsU2Nyb2xsQ29udGFpbmVyLmFkZFNjcm9sbFRvcChkaWZmVG9wKTtcbiAgICAgICAgfSBlbHNlIGlmIChkaWZmQm90dG9tID4gMCkge1xuICAgICAgICAgICAgLy8gY2VsbCBpcyBiZWxvdyBncmlkIGJvdHRvbSAtIG5vdCB2aXNpYmxlXG4gICAgICAgICAgICB0aGlzLmdyaWQubmF0aXZlRWxlbWVudC5mb2N1cyh7IHByZXZlbnRTY3JvbGw6IHRydWUgfSk7XG4gICAgICAgICAgICB0aGlzLmdyaWQudmVydGljYWxTY3JvbGxDb250YWluZXIub25DaHVua0xvYWRcbiAgICAgICAgICAgICAgICAucGlwZShmaXJzdCgpKVxuICAgICAgICAgICAgICAgIC5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjZWxsRWxlbS5mb2N1cyh7IHByZXZlbnRTY3JvbGw6IHRydWUgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMuZ3JpZC52ZXJ0aWNhbFNjcm9sbENvbnRhaW5lci5hZGRTY3JvbGxUb3AoZGlmZkJvdHRvbSk7XG4gICAgICAgIH0gIGVsc2Uge1xuICAgICAgICAgICAgLy8gY2VsbCBpcyB2aXNpYmxlXG4gICAgICAgICAgICBjZWxsRWxlbS5mb2N1cyh7IHByZXZlbnRTY3JvbGw6IHRydWUgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgZ29Ub0ZpcnN0Q2VsbCgpIHtcbiAgICAgICAgdGhpcy5zdGFydE5hdmlnYXRpb25DZWxsID0gbnVsbDtcbiAgICAgICAgc3VwZXIuZ29Ub0ZpcnN0Q2VsbCgpO1xuICAgIH1cblxuICAgIHB1YmxpYyBnb1RvTGFzdENlbGwoKSB7XG4gICAgICAgIHRoaXMuc3RhcnROYXZpZ2F0aW9uQ2VsbCA9IG51bGw7XG4gICAgICAgIHN1cGVyLmdvVG9MYXN0Q2VsbCgpO1xuICAgIH1cbn1cbiJdfQ==